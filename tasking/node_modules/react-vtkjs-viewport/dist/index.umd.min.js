!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("vtk.js/Sources/macro"),require("react"),require("vtk.js/Sources/Rendering/Core/Coordinate"),require("vtk.js/Sources/Common/Core/Math"),require("cornerstone-core"),require("vtk.js/Sources/Rendering/Core/InteractorStyle/Constants"),require("vtk.js/Sources/Common/Core/MatrixBuilder"),require("vtk.js/Sources/Rendering/Misc/GenericRenderWindow"),require("vtk.js/Sources/Widgets/Core/WidgetManager"),require("vtk.js/Sources/Filters/General/PaintFilter"),require("vtk.js/Sources/Widgets/Widgets3D/PaintWidget"),require("vtk.js/Sources/Widgets/Core/WidgetManager/Constants"),require("vtk.js/Sources/Common/DataModel/ImageData"),require("vtk.js/Sources/Common/Core/DataArray"),require("cornerstone-tools"),require("vtk.js/Sources/Rendering/Core/Renderer"),require("vtk.js/Sources/Interaction/Style/InteractorStyleManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballRotateManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballPanManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballZoomManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseRangeManipulator"),require("vtk.js/Sources/Rendering/Core/Volume"),require("vtk.js/Sources/Rendering/Core/VolumeMapper"),require("vtk.js/Sources/Rendering/Core/ColorTransferFunction"),require("vtk.js/Sources/Common/DataModel/PiecewiseFunction")):"function"==typeof define&&define.amd?define(["vtk.js/Sources/macro","react","vtk.js/Sources/Rendering/Core/Coordinate","vtk.js/Sources/Common/Core/Math","cornerstone-core","vtk.js/Sources/Rendering/Core/InteractorStyle/Constants","vtk.js/Sources/Common/Core/MatrixBuilder","vtk.js/Sources/Rendering/Misc/GenericRenderWindow","vtk.js/Sources/Widgets/Core/WidgetManager","vtk.js/Sources/Filters/General/PaintFilter","vtk.js/Sources/Widgets/Widgets3D/PaintWidget","vtk.js/Sources/Widgets/Core/WidgetManager/Constants","vtk.js/Sources/Common/DataModel/ImageData","vtk.js/Sources/Common/Core/DataArray","cornerstone-tools","vtk.js/Sources/Rendering/Core/Renderer","vtk.js/Sources/Interaction/Style/InteractorStyleManipulator","vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballRotateManipulator","vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballPanManipulator","vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballZoomManipulator","vtk.js/Sources/Interaction/Manipulators/MouseRangeManipulator","vtk.js/Sources/Rendering/Core/Volume","vtk.js/Sources/Rendering/Core/VolumeMapper","vtk.js/Sources/Rendering/Core/ColorTransferFunction","vtk.js/Sources/Common/DataModel/PiecewiseFunction"],e):"object"==typeof exports?exports.VTKViewport=e(require("vtk.js/Sources/macro"),require("react"),require("vtk.js/Sources/Rendering/Core/Coordinate"),require("vtk.js/Sources/Common/Core/Math"),require("cornerstone-core"),require("vtk.js/Sources/Rendering/Core/InteractorStyle/Constants"),require("vtk.js/Sources/Common/Core/MatrixBuilder"),require("vtk.js/Sources/Rendering/Misc/GenericRenderWindow"),require("vtk.js/Sources/Widgets/Core/WidgetManager"),require("vtk.js/Sources/Filters/General/PaintFilter"),require("vtk.js/Sources/Widgets/Widgets3D/PaintWidget"),require("vtk.js/Sources/Widgets/Core/WidgetManager/Constants"),require("vtk.js/Sources/Common/DataModel/ImageData"),require("vtk.js/Sources/Common/Core/DataArray"),require("cornerstone-tools"),require("vtk.js/Sources/Rendering/Core/Renderer"),require("vtk.js/Sources/Interaction/Style/InteractorStyleManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballRotateManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballPanManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballZoomManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseRangeManipulator"),require("vtk.js/Sources/Rendering/Core/Volume"),require("vtk.js/Sources/Rendering/Core/VolumeMapper"),require("vtk.js/Sources/Rendering/Core/ColorTransferFunction"),require("vtk.js/Sources/Common/DataModel/PiecewiseFunction")):t.VTKViewport=e(t["vtk.js/Sources/macro"],t.react,t["vtk.js/Sources/Rendering/Core/Coordinate"],t["vtk.js/Sources/Common/Core/Math"],t.cornerstone,t["vtk.js/Sources/Rendering/Core/InteractorStyle/Constants"],t["vtk.js/Sources/Common/Core/MatrixBuilder"],t["vtk.js/Sources/Rendering/Misc/GenericRenderWindow"],t["vtk.js/Sources/Widgets/Core/WidgetManager"],t["vtk.js/Sources/Filters/General/PaintFilter"],t["vtk.js/Sources/Widgets/Widgets3D/PaintWidget"],t["vtk.js/Sources/Widgets/Core/WidgetManager/Constants"],t["vtk.js/Sources/Common/DataModel/ImageData"],t["vtk.js/Sources/Common/Core/DataArray"],t.cornerstoneTools,t["vtk.js/Sources/Rendering/Core/Renderer"],t["vtk.js/Sources/Interaction/Style/InteractorStyleManipulator"],t["vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballRotateManipulator"],t["vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballPanManipulator"],t["vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballZoomManipulator"],t["vtk.js/Sources/Interaction/Manipulators/MouseRangeManipulator"],t["vtk.js/Sources/Rendering/Core/Volume"],t["vtk.js/Sources/Rendering/Core/VolumeMapper"],t["vtk.js/Sources/Rendering/Core/ColorTransferFunction"],t["vtk.js/Sources/Common/DataModel/PiecewiseFunction"])}(this,(function(t,e,n,r,a,i,o,s,u,c,d,l,h,f,g,p,v,m,w,b,y,M,S,x,C){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=55)}([function(t,e,n){t.exports=n(48)()},function(e,n){e.exports=t},function(t,e,n){var r=n(43),a=n(44),i=n(45);t.exports=function(t){return r(t)||a(t)||i()}},function(t,n){t.exports=e},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e){t.exports=n},function(t,e){t.exports=r},function(t,e,n){var r=n(40),a=n(41),i=n(42);t.exports=function(t,e){return r(t)||a(t,e)||i()}},function(t,e){t.exports=a},function(t,e){t.exports=i},function(t,e){t.exports=o},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}},function(t,e,n){var r=n(46),a=n(24);t.exports=function(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?a(t):e}},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e,n){var r=n(47);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}},function(t,e){function n(){return t.exports=n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},n.apply(this,arguments)}t.exports=n},function(t,e){t.exports=s},function(t,e){t.exports=u},function(t,e){t.exports=c},function(t,e){t.exports=d},function(t,e){t.exports=l},function(t,e){t.exports=h},function(t,e){t.exports=f},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){t.exports=g},function(t,e){t.exports=p},function(t,e){t.exports=v},function(t,e){t.exports=m},function(t,e){t.exports=w},function(t,e){t.exports=b},function(t,e){t.exports=y},function(t,e){t.exports=M},function(t,e){t.exports=S},function(t,e){t.exports=x},function(t,e){t.exports=C},,,,,function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){a=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(e){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?t.exports=r=function(t){return n(t)}:t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":n(t)},r(e)}t.exports=r},function(t,e){function n(e,r){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,r)}t.exports=n},function(t,e,n){"use strict";var r=n(49);function a(){}function i(){}i.resetWarningCache=a,t.exports=function(){function t(t,e,n,a,i,o){if(o!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function e(){return t}t.isRequired=t;var n={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:i,resetWarningCache:a};return n.PropTypes=n,n}},function(t,e,n){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(t,e,n){var r=n(51);"string"==typeof r&&(r=[[t.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(53)(r,a);r.locals&&(t.exports=r.locals)},function(t,e,n){(t.exports=n(52)(!1)).push([t.i,":root {\n  --viewport-tag-padding: 20px;\n}\n\n.ViewportOverlay {\n  color: #9ccef9;\n}\n\n.ViewportOverlay .overlay-element {\n  position: absolute;\n  font-weight: 400;\n  text-shadow: 1px 1px black;\n  pointer-events: none;\n}\n\n.ViewportOverlay .top-left {\n  top: var(--viewport-tag-padding);\n  left: var(--viewport-tag-padding);\n}\n\n.ViewportOverlay .top-center {\n  top: var(--viewport-tag-padding);\n  padding-top: var(--viewport-tag-padding);\n  width: 100%;\n  text-align: center;\n}\n\n.ViewportOverlay .top-right {\n  top: var(--viewport-tag-padding);\n  right: var(--viewport-tag-padding);\n  text-align: right;\n}\n\n.ViewportOverlay .bottom-left {\n  bottom: var(--viewport-tag-padding);\n  left: var(--viewport-tag-padding);\n}\n\n.ViewportOverlay .bottom-right {\n  bottom: var(--viewport-tag-padding);\n  right: var(--viewport-tag-padding);\n  text-align: right;\n}\n\n.ViewportOverlay svg {\n  color: #9ccef9;\n  fill: #9ccef9;\n  stroke: #9ccef9;\n  background-color: transparent;\n  margin: 2px;\n  width: 18px;\n  height: 18px;\n}\n",""])},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",r=t[3];if(!r)return n;if(e&&"function"==typeof btoa){var a=(o=r,s=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),u="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(u," */")),i=r.sources.map((function(t){return"/*# sourceURL=".concat(r.sourceRoot).concat(t," */")}));return[n].concat(i).concat([a]).join("\n")}var o,s,u;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2],"{").concat(n,"}"):n})).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},a=0;a<this.length;a++){var i=this[a][0];null!=i&&(r[i]=!0)}for(var o=0;o<t.length;o++){var s=t[o];null!=s[0]&&r[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="(".concat(s[2],") and (").concat(n,")")),e.push(s))}},e}},function(t,e,n){var r,a,i={},o=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===a&&(a=r.apply(this,arguments)),a}),s=function(t,e){return e?e.querySelector(t):document.querySelector(t)},u=function(t){var e={};return function(t,n){if("function"==typeof t)return t();if(void 0===e[t]){var r=s.call(this,t,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}}(),c=null,d=0,l=[],h=n(54);function f(t,e){for(var n=0;n<t.length;n++){var r=t[n],a=i[r.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](r.parts[o]);for(;o<r.parts.length;o++)a.parts.push(b(r.parts[o],e))}else{var s=[];for(o=0;o<r.parts.length;o++)s.push(b(r.parts[o],e));i[r.id]={id:r.id,refs:1,parts:s}}}}function g(t,e){for(var n=[],r={},a=0;a<t.length;a++){var i=t[a],o=e.base?i[0]+e.base:i[0],s={css:i[1],media:i[2],sourceMap:i[3]};r[o]?r[o].parts.push(s):n.push(r[o]={id:o,parts:[s]})}return n}function p(t,e){var n=u(t.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=l[l.length-1];if("top"===t.insertAt)r?r.nextSibling?n.insertBefore(e,r.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),l.push(e);else if("bottom"===t.insertAt)n.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var a=u(t.insertAt.before,n);n.insertBefore(e,a)}}function v(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=l.indexOf(t);e>=0&&l.splice(e,1)}function m(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var r=function(){0;return n.nc}();r&&(t.attrs.nonce=r)}return w(e,t.attrs),p(t,e),e}function w(t,e){Object.keys(e).forEach((function(n){t.setAttribute(n,e[n])}))}function b(t,e){var n,r,a,i;if(e.transform&&t.css){if(!(i="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=i}if(e.singleton){var o=d++;n=c||(c=m(e)),r=S.bind(null,n,o,!1),a=S.bind(null,n,o,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",w(e,t.attrs),p(t,e),e}(e),r=C.bind(null,n,e),a=function(){v(n),n.href&&URL.revokeObjectURL(n.href)}):(n=m(e),r=x.bind(null,n),a=function(){v(n)});return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else a()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=o()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var n=g(t,e);return f(n,e),function(t){for(var r=[],a=0;a<n.length;a++){var o=n[a];(s=i[o.id]).refs--,r.push(s)}t&&f(g(t,e),e);for(a=0;a<r.length;a++){var s;if(0===(s=r[a]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete i[s.id]}}}};var y,M=(y=[],function(t,e){return y[t]=e,y.filter(Boolean).join("\n")});function S(t,e,n,r){var a=n?"":r.css;if(t.styleSheet)t.styleSheet.cssText=M(e,a);else{var i=document.createTextNode(a),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(i,o[e]):t.appendChild(i)}}function x(t,e){var n=e.css,r=e.media;if(r&&t.setAttribute("media",r),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}function C(t,e,n){var r=n.css,a=n.sourceMap,i=void 0===e.convertToAbsoluteUrls&&a;(e.convertToAbsoluteUrls||i)&&(r=h(r)),a&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */");var o=new Blob([r],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var n=e.protocol+"//"+e.host,r=n+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var a,i=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?t:(a=0===i.indexOf("//")?i:0===i.indexOf("/")?n+i:r+i.replace(/^\.\//,""),"url("+JSON.stringify(a)+")")}))}},function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"create",(function(){return ut})),n.d(r,"clone",(function(){return ct})),n.d(r,"copy",(function(){return dt})),n.d(r,"fromValues",(function(){return lt})),n.d(r,"set",(function(){return ht})),n.d(r,"identity",(function(){return ft})),n.d(r,"transpose",(function(){return gt})),n.d(r,"invert",(function(){return pt})),n.d(r,"adjoint",(function(){return vt})),n.d(r,"determinant",(function(){return mt})),n.d(r,"multiply",(function(){return wt})),n.d(r,"translate",(function(){return bt})),n.d(r,"scale",(function(){return yt})),n.d(r,"rotate",(function(){return Mt})),n.d(r,"rotateX",(function(){return St})),n.d(r,"rotateY",(function(){return xt})),n.d(r,"rotateZ",(function(){return Ct})),n.d(r,"fromTranslation",(function(){return kt})),n.d(r,"fromScaling",(function(){return Tt})),n.d(r,"fromRotation",(function(){return Rt})),n.d(r,"fromXRotation",(function(){return Wt})),n.d(r,"fromYRotation",(function(){return Dt})),n.d(r,"fromZRotation",(function(){return Pt})),n.d(r,"fromRotationTranslation",(function(){return It})),n.d(r,"fromQuat2",(function(){return Et})),n.d(r,"getTranslation",(function(){return Ot})),n.d(r,"getScaling",(function(){return jt})),n.d(r,"getRotation",(function(){return qt})),n.d(r,"fromRotationTranslationScale",(function(){return At})),n.d(r,"fromRotationTranslationScaleOrigin",(function(){return Lt})),n.d(r,"fromQuat",(function(){return Ut})),n.d(r,"frustum",(function(){return Vt})),n.d(r,"perspective",(function(){return Nt})),n.d(r,"perspectiveFromFieldOfView",(function(){return Ft})),n.d(r,"ortho",(function(){return Bt})),n.d(r,"lookAt",(function(){return Ht})),n.d(r,"targetTo",(function(){return Gt})),n.d(r,"str",(function(){return _t})),n.d(r,"frob",(function(){return Yt})),n.d(r,"add",(function(){return zt})),n.d(r,"subtract",(function(){return Qt})),n.d(r,"multiplyScalar",(function(){return Xt})),n.d(r,"multiplyScalarAndAdd",(function(){return Kt})),n.d(r,"exactEquals",(function(){return Zt})),n.d(r,"equals",(function(){return Jt})),n.d(r,"mul",(function(){return $t})),n.d(r,"sub",(function(){return te}));var a={};n.r(a),n.d(a,"create",(function(){return ee})),n.d(a,"clone",(function(){return ne})),n.d(a,"length",(function(){return re})),n.d(a,"fromValues",(function(){return ae})),n.d(a,"copy",(function(){return ie})),n.d(a,"set",(function(){return oe})),n.d(a,"add",(function(){return se})),n.d(a,"subtract",(function(){return ue})),n.d(a,"multiply",(function(){return ce})),n.d(a,"divide",(function(){return de})),n.d(a,"ceil",(function(){return le})),n.d(a,"floor",(function(){return he})),n.d(a,"min",(function(){return fe})),n.d(a,"max",(function(){return ge})),n.d(a,"round",(function(){return pe})),n.d(a,"scale",(function(){return ve})),n.d(a,"scaleAndAdd",(function(){return me})),n.d(a,"distance",(function(){return we})),n.d(a,"squaredDistance",(function(){return be})),n.d(a,"squaredLength",(function(){return ye})),n.d(a,"negate",(function(){return Me})),n.d(a,"inverse",(function(){return Se})),n.d(a,"normalize",(function(){return xe})),n.d(a,"dot",(function(){return Ce})),n.d(a,"cross",(function(){return ke})),n.d(a,"lerp",(function(){return Te})),n.d(a,"hermite",(function(){return Re})),n.d(a,"bezier",(function(){return We})),n.d(a,"random",(function(){return De})),n.d(a,"transformMat4",(function(){return Pe})),n.d(a,"transformMat3",(function(){return Ie})),n.d(a,"transformQuat",(function(){return Ee})),n.d(a,"rotateX",(function(){return Oe})),n.d(a,"rotateY",(function(){return je})),n.d(a,"rotateZ",(function(){return qe})),n.d(a,"angle",(function(){return Ae})),n.d(a,"zero",(function(){return Le})),n.d(a,"str",(function(){return Ue})),n.d(a,"exactEquals",(function(){return Ve})),n.d(a,"equals",(function(){return Ne})),n.d(a,"sub",(function(){return Be})),n.d(a,"mul",(function(){return He})),n.d(a,"div",(function(){return Ge})),n.d(a,"dist",(function(){return _e})),n.d(a,"sqrDist",(function(){return Ye})),n.d(a,"len",(function(){return ze})),n.d(a,"sqrLen",(function(){return Qe})),n.d(a,"forEach",(function(){return Xe}));var i={};n.r(i),n.d(i,"create",(function(){return Je})),n.d(i,"identity",(function(){return $e})),n.d(i,"setAxisAngle",(function(){return tn})),n.d(i,"getAxisAngle",(function(){return en})),n.d(i,"getAngle",(function(){return nn})),n.d(i,"multiply",(function(){return rn})),n.d(i,"rotateX",(function(){return an})),n.d(i,"rotateY",(function(){return on})),n.d(i,"rotateZ",(function(){return sn})),n.d(i,"calculateW",(function(){return un})),n.d(i,"exp",(function(){return cn})),n.d(i,"ln",(function(){return dn})),n.d(i,"pow",(function(){return ln})),n.d(i,"slerp",(function(){return hn})),n.d(i,"random",(function(){return fn})),n.d(i,"invert",(function(){return gn})),n.d(i,"conjugate",(function(){return pn})),n.d(i,"fromMat3",(function(){return vn})),n.d(i,"fromEuler",(function(){return mn})),n.d(i,"str",(function(){return wn})),n.d(i,"clone",(function(){return Tn})),n.d(i,"fromValues",(function(){return Rn})),n.d(i,"copy",(function(){return Wn})),n.d(i,"set",(function(){return Dn})),n.d(i,"add",(function(){return Pn})),n.d(i,"mul",(function(){return In})),n.d(i,"scale",(function(){return En})),n.d(i,"dot",(function(){return On})),n.d(i,"lerp",(function(){return jn})),n.d(i,"length",(function(){return qn})),n.d(i,"len",(function(){return An})),n.d(i,"squaredLength",(function(){return Ln})),n.d(i,"sqrLen",(function(){return Un})),n.d(i,"normalize",(function(){return Vn})),n.d(i,"exactEquals",(function(){return Nn})),n.d(i,"equals",(function(){return Fn})),n.d(i,"rotationTo",(function(){return Bn})),n.d(i,"sqlerp",(function(){return Hn})),n.d(i,"setAxes",(function(){return Gn}));var o={};n.r(o),n.d(o,"create",(function(){return _n})),n.d(o,"clone",(function(){return Yn})),n.d(o,"fromValues",(function(){return zn})),n.d(o,"copy",(function(){return Qn})),n.d(o,"set",(function(){return Xn})),n.d(o,"add",(function(){return Kn})),n.d(o,"subtract",(function(){return Zn})),n.d(o,"multiply",(function(){return Jn})),n.d(o,"divide",(function(){return $n})),n.d(o,"ceil",(function(){return tr})),n.d(o,"floor",(function(){return er})),n.d(o,"min",(function(){return nr})),n.d(o,"max",(function(){return rr})),n.d(o,"round",(function(){return ar})),n.d(o,"scale",(function(){return ir})),n.d(o,"scaleAndAdd",(function(){return or})),n.d(o,"distance",(function(){return sr})),n.d(o,"squaredDistance",(function(){return ur})),n.d(o,"length",(function(){return cr})),n.d(o,"squaredLength",(function(){return dr})),n.d(o,"negate",(function(){return lr})),n.d(o,"inverse",(function(){return hr})),n.d(o,"normalize",(function(){return fr})),n.d(o,"dot",(function(){return gr})),n.d(o,"cross",(function(){return pr})),n.d(o,"lerp",(function(){return vr})),n.d(o,"random",(function(){return mr})),n.d(o,"transformMat2",(function(){return wr})),n.d(o,"transformMat2d",(function(){return br})),n.d(o,"transformMat3",(function(){return yr})),n.d(o,"transformMat4",(function(){return Mr})),n.d(o,"rotate",(function(){return Sr})),n.d(o,"angle",(function(){return xr})),n.d(o,"zero",(function(){return Cr})),n.d(o,"str",(function(){return kr})),n.d(o,"exactEquals",(function(){return Tr})),n.d(o,"equals",(function(){return Rr})),n.d(o,"len",(function(){return Wr})),n.d(o,"sub",(function(){return Dr})),n.d(o,"mul",(function(){return Pr})),n.d(o,"div",(function(){return Ir})),n.d(o,"dist",(function(){return Er})),n.d(o,"sqrDist",(function(){return Or})),n.d(o,"sqrLen",(function(){return jr})),n.d(o,"forEach",(function(){return qr}));var s=n(16),u=n.n(s),c=n(7),d=n.n(c),l=n(2),h=n.n(l),f=n(11),g=n.n(f),p=n(12),v=n.n(p),m=n(13),w=n.n(m),b=n(14),y=n.n(b),M=n(24),S=n.n(M),x=n(15),C=n.n(x),k=n(4),T=n.n(k),R=n(3),W=n.n(R),D=n(0),P=n.n(D),I=n(25),E=n.n(I),O=n(17),j=n.n(O),q=n(26),A=n.n(q),L=n(18),U=n.n(L),V=n(1),N=n.n(V),F=n(6),B=n.n(F),H=n(10),G=n.n(H),_=n(27),Y=n.n(_),z=n(28),Q=n.n(z),X=n(29),K=n.n(X),Z=n(30),J=n.n(Z),$=n(31),tt=n.n($),et=n(5),nt=n.n(et),rt=n(9),at=n.n(rt),it=1e-6,ot="undefined"!=typeof Float32Array?Float32Array:Array,st=Math.random;Math.PI;function ut(){var t=new ot(16);return ot!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function ct(t){var e=new ot(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function dt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function lt(t,e,n,r,a,i,o,s,u,c,d,l,h,f,g,p){var v=new ot(16);return v[0]=t,v[1]=e,v[2]=n,v[3]=r,v[4]=a,v[5]=i,v[6]=o,v[7]=s,v[8]=u,v[9]=c,v[10]=d,v[11]=l,v[12]=h,v[13]=f,v[14]=g,v[15]=p,v}function ht(t,e,n,r,a,i,o,s,u,c,d,l,h,f,g,p,v){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=i,t[5]=o,t[6]=s,t[7]=u,t[8]=c,t[9]=d,t[10]=l,t[11]=h,t[12]=f,t[13]=g,t[14]=p,t[15]=v,t}function ft(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function gt(t,e){if(t===e){var n=e[1],r=e[2],a=e[3],i=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=i,t[11]=e[14],t[12]=a,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function pt(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],u=e[6],c=e[7],d=e[8],l=e[9],h=e[10],f=e[11],g=e[12],p=e[13],v=e[14],m=e[15],w=n*s-r*o,b=n*u-a*o,y=n*c-i*o,M=r*u-a*s,S=r*c-i*s,x=a*c-i*u,C=d*p-l*g,k=d*v-h*g,T=d*m-f*g,R=l*v-h*p,W=l*m-f*p,D=h*m-f*v,P=w*D-b*W+y*R+M*T-S*k+x*C;return P?(P=1/P,t[0]=(s*D-u*W+c*R)*P,t[1]=(a*W-r*D-i*R)*P,t[2]=(p*x-v*S+m*M)*P,t[3]=(h*S-l*x-f*M)*P,t[4]=(u*T-o*D-c*k)*P,t[5]=(n*D-a*T+i*k)*P,t[6]=(v*y-g*x-m*b)*P,t[7]=(d*x-h*y+f*b)*P,t[8]=(o*W-s*T+c*C)*P,t[9]=(r*T-n*W-i*C)*P,t[10]=(g*S-p*y+m*w)*P,t[11]=(l*y-d*S-f*w)*P,t[12]=(s*k-o*R-u*C)*P,t[13]=(n*R-r*k+a*C)*P,t[14]=(p*b-g*M-v*w)*P,t[15]=(d*M-l*b+h*w)*P,t):null}function vt(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],u=e[6],c=e[7],d=e[8],l=e[9],h=e[10],f=e[11],g=e[12],p=e[13],v=e[14],m=e[15];return t[0]=s*(h*m-f*v)-l*(u*m-c*v)+p*(u*f-c*h),t[1]=-(r*(h*m-f*v)-l*(a*m-i*v)+p*(a*f-i*h)),t[2]=r*(u*m-c*v)-s*(a*m-i*v)+p*(a*c-i*u),t[3]=-(r*(u*f-c*h)-s*(a*f-i*h)+l*(a*c-i*u)),t[4]=-(o*(h*m-f*v)-d*(u*m-c*v)+g*(u*f-c*h)),t[5]=n*(h*m-f*v)-d*(a*m-i*v)+g*(a*f-i*h),t[6]=-(n*(u*m-c*v)-o*(a*m-i*v)+g*(a*c-i*u)),t[7]=n*(u*f-c*h)-o*(a*f-i*h)+d*(a*c-i*u),t[8]=o*(l*m-f*p)-d*(s*m-c*p)+g*(s*f-c*l),t[9]=-(n*(l*m-f*p)-d*(r*m-i*p)+g*(r*f-i*l)),t[10]=n*(s*m-c*p)-o*(r*m-i*p)+g*(r*c-i*s),t[11]=-(n*(s*f-c*l)-o*(r*f-i*l)+d*(r*c-i*s)),t[12]=-(o*(l*v-h*p)-d*(s*v-u*p)+g*(s*h-u*l)),t[13]=n*(l*v-h*p)-d*(r*v-a*p)+g*(r*h-a*l),t[14]=-(n*(s*v-u*p)-o*(r*v-a*p)+g*(r*u-a*s)),t[15]=n*(s*h-u*l)-o*(r*h-a*l)+d*(r*u-a*s),t}function mt(t){var e=t[0],n=t[1],r=t[2],a=t[3],i=t[4],o=t[5],s=t[6],u=t[7],c=t[8],d=t[9],l=t[10],h=t[11],f=t[12],g=t[13],p=t[14],v=t[15];return(e*o-n*i)*(l*v-h*p)-(e*s-r*i)*(d*v-h*g)+(e*u-a*i)*(d*p-l*g)+(n*s-r*o)*(c*v-h*f)-(n*u-a*o)*(c*p-l*f)+(r*u-a*s)*(c*g-d*f)}function wt(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],u=e[5],c=e[6],d=e[7],l=e[8],h=e[9],f=e[10],g=e[11],p=e[12],v=e[13],m=e[14],w=e[15],b=n[0],y=n[1],M=n[2],S=n[3];return t[0]=b*r+y*s+M*l+S*p,t[1]=b*a+y*u+M*h+S*v,t[2]=b*i+y*c+M*f+S*m,t[3]=b*o+y*d+M*g+S*w,b=n[4],y=n[5],M=n[6],S=n[7],t[4]=b*r+y*s+M*l+S*p,t[5]=b*a+y*u+M*h+S*v,t[6]=b*i+y*c+M*f+S*m,t[7]=b*o+y*d+M*g+S*w,b=n[8],y=n[9],M=n[10],S=n[11],t[8]=b*r+y*s+M*l+S*p,t[9]=b*a+y*u+M*h+S*v,t[10]=b*i+y*c+M*f+S*m,t[11]=b*o+y*d+M*g+S*w,b=n[12],y=n[13],M=n[14],S=n[15],t[12]=b*r+y*s+M*l+S*p,t[13]=b*a+y*u+M*h+S*v,t[14]=b*i+y*c+M*f+S*m,t[15]=b*o+y*d+M*g+S*w,t}function bt(t,e,n){var r,a,i,o,s,u,c,d,l,h,f,g,p=n[0],v=n[1],m=n[2];return e===t?(t[12]=e[0]*p+e[4]*v+e[8]*m+e[12],t[13]=e[1]*p+e[5]*v+e[9]*m+e[13],t[14]=e[2]*p+e[6]*v+e[10]*m+e[14],t[15]=e[3]*p+e[7]*v+e[11]*m+e[15]):(r=e[0],a=e[1],i=e[2],o=e[3],s=e[4],u=e[5],c=e[6],d=e[7],l=e[8],h=e[9],f=e[10],g=e[11],t[0]=r,t[1]=a,t[2]=i,t[3]=o,t[4]=s,t[5]=u,t[6]=c,t[7]=d,t[8]=l,t[9]=h,t[10]=f,t[11]=g,t[12]=r*p+s*v+l*m+e[12],t[13]=a*p+u*v+h*m+e[13],t[14]=i*p+c*v+f*m+e[14],t[15]=o*p+d*v+g*m+e[15]),t}function yt(t,e,n){var r=n[0],a=n[1],i=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Mt(t,e,n,r){var a,i,o,s,u,c,d,l,h,f,g,p,v,m,w,b,y,M,S,x,C,k,T,R,W=r[0],D=r[1],P=r[2],I=Math.hypot(W,D,P);return I<it?null:(W*=I=1/I,D*=I,P*=I,a=Math.sin(n),o=1-(i=Math.cos(n)),s=e[0],u=e[1],c=e[2],d=e[3],l=e[4],h=e[5],f=e[6],g=e[7],p=e[8],v=e[9],m=e[10],w=e[11],b=W*W*o+i,y=D*W*o+P*a,M=P*W*o-D*a,S=W*D*o-P*a,x=D*D*o+i,C=P*D*o+W*a,k=W*P*o+D*a,T=D*P*o-W*a,R=P*P*o+i,t[0]=s*b+l*y+p*M,t[1]=u*b+h*y+v*M,t[2]=c*b+f*y+m*M,t[3]=d*b+g*y+w*M,t[4]=s*S+l*x+p*C,t[5]=u*S+h*x+v*C,t[6]=c*S+f*x+m*C,t[7]=d*S+g*x+w*C,t[8]=s*k+l*T+p*R,t[9]=u*k+h*T+v*R,t[10]=c*k+f*T+m*R,t[11]=d*k+g*T+w*R,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function St(t,e,n){var r=Math.sin(n),a=Math.cos(n),i=e[4],o=e[5],s=e[6],u=e[7],c=e[8],d=e[9],l=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*a+c*r,t[5]=o*a+d*r,t[6]=s*a+l*r,t[7]=u*a+h*r,t[8]=c*a-i*r,t[9]=d*a-o*r,t[10]=l*a-s*r,t[11]=h*a-u*r,t}function xt(t,e,n){var r=Math.sin(n),a=Math.cos(n),i=e[0],o=e[1],s=e[2],u=e[3],c=e[8],d=e[9],l=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a-c*r,t[1]=o*a-d*r,t[2]=s*a-l*r,t[3]=u*a-h*r,t[8]=i*r+c*a,t[9]=o*r+d*a,t[10]=s*r+l*a,t[11]=u*r+h*a,t}function Ct(t,e,n){var r=Math.sin(n),a=Math.cos(n),i=e[0],o=e[1],s=e[2],u=e[3],c=e[4],d=e[5],l=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a+c*r,t[1]=o*a+d*r,t[2]=s*a+l*r,t[3]=u*a+h*r,t[4]=c*a-i*r,t[5]=d*a-o*r,t[6]=l*a-s*r,t[7]=h*a-u*r,t}function kt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Tt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Rt(t,e,n){var r,a,i,o=n[0],s=n[1],u=n[2],c=Math.hypot(o,s,u);return c<it?null:(o*=c=1/c,s*=c,u*=c,r=Math.sin(e),i=1-(a=Math.cos(e)),t[0]=o*o*i+a,t[1]=s*o*i+u*r,t[2]=u*o*i-s*r,t[3]=0,t[4]=o*s*i-u*r,t[5]=s*s*i+a,t[6]=u*s*i+o*r,t[7]=0,t[8]=o*u*i+s*r,t[9]=s*u*i-o*r,t[10]=u*u*i+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Wt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Dt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Pt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function It(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=r+r,u=a+a,c=i+i,d=r*s,l=r*u,h=r*c,f=a*u,g=a*c,p=i*c,v=o*s,m=o*u,w=o*c;return t[0]=1-(f+p),t[1]=l+w,t[2]=h-m,t[3]=0,t[4]=l-w,t[5]=1-(d+p),t[6]=g+v,t[7]=0,t[8]=h+m,t[9]=g-v,t[10]=1-(d+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Et(t,e){var n=new ot(3),r=-e[0],a=-e[1],i=-e[2],o=e[3],s=e[4],u=e[5],c=e[6],d=e[7],l=r*r+a*a+i*i+o*o;return l>0?(n[0]=2*(s*o+d*r+u*i-c*a)/l,n[1]=2*(u*o+d*a+c*r-s*i)/l,n[2]=2*(c*o+d*i+s*a-u*r)/l):(n[0]=2*(s*o+d*r+u*i-c*a),n[1]=2*(u*o+d*a+c*r-s*i),n[2]=2*(c*o+d*i+s*a-u*r)),It(t,e,n),t}function Ot(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function jt(t,e){var n=e[0],r=e[1],a=e[2],i=e[4],o=e[5],s=e[6],u=e[8],c=e[9],d=e[10];return t[0]=Math.hypot(n,r,a),t[1]=Math.hypot(i,o,s),t[2]=Math.hypot(u,c,d),t}function qt(t,e){var n=new ot(3);jt(n,e);var r=1/n[0],a=1/n[1],i=1/n[2],o=e[0]*r,s=e[1]*a,u=e[2]*i,c=e[4]*r,d=e[5]*a,l=e[6]*i,h=e[8]*r,f=e[9]*a,g=e[10]*i,p=o+d+g,v=0;return p>0?(v=2*Math.sqrt(p+1),t[3]=.25*v,t[0]=(l-f)/v,t[1]=(h-u)/v,t[2]=(s-c)/v):o>d&&o>g?(v=2*Math.sqrt(1+o-d-g),t[3]=(l-f)/v,t[0]=.25*v,t[1]=(s+c)/v,t[2]=(h+u)/v):d>g?(v=2*Math.sqrt(1+d-o-g),t[3]=(h-u)/v,t[0]=(s+c)/v,t[1]=.25*v,t[2]=(l+f)/v):(v=2*Math.sqrt(1+g-o-d),t[3]=(s-c)/v,t[0]=(h+u)/v,t[1]=(l+f)/v,t[2]=.25*v),t}function At(t,e,n,r){var a=e[0],i=e[1],o=e[2],s=e[3],u=a+a,c=i+i,d=o+o,l=a*u,h=a*c,f=a*d,g=i*c,p=i*d,v=o*d,m=s*u,w=s*c,b=s*d,y=r[0],M=r[1],S=r[2];return t[0]=(1-(g+v))*y,t[1]=(h+b)*y,t[2]=(f-w)*y,t[3]=0,t[4]=(h-b)*M,t[5]=(1-(l+v))*M,t[6]=(p+m)*M,t[7]=0,t[8]=(f+w)*S,t[9]=(p-m)*S,t[10]=(1-(l+g))*S,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Lt(t,e,n,r,a){var i=e[0],o=e[1],s=e[2],u=e[3],c=i+i,d=o+o,l=s+s,h=i*c,f=i*d,g=i*l,p=o*d,v=o*l,m=s*l,w=u*c,b=u*d,y=u*l,M=r[0],S=r[1],x=r[2],C=a[0],k=a[1],T=a[2],R=(1-(p+m))*M,W=(f+y)*M,D=(g-b)*M,P=(f-y)*S,I=(1-(h+m))*S,E=(v+w)*S,O=(g+b)*x,j=(v-w)*x,q=(1-(h+p))*x;return t[0]=R,t[1]=W,t[2]=D,t[3]=0,t[4]=P,t[5]=I,t[6]=E,t[7]=0,t[8]=O,t[9]=j,t[10]=q,t[11]=0,t[12]=n[0]+C-(R*C+P*k+O*T),t[13]=n[1]+k-(W*C+I*k+j*T),t[14]=n[2]+T-(D*C+E*k+q*T),t[15]=1,t}function Ut(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=n+n,s=r+r,u=a+a,c=n*o,d=r*o,l=r*s,h=a*o,f=a*s,g=a*u,p=i*o,v=i*s,m=i*u;return t[0]=1-l-g,t[1]=d+m,t[2]=h-v,t[3]=0,t[4]=d-m,t[5]=1-c-g,t[6]=f+p,t[7]=0,t[8]=h+v,t[9]=f-p,t[10]=1-c-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Vt(t,e,n,r,a,i,o){var s=1/(n-e),u=1/(a-r),c=1/(i-o);return t[0]=2*i*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(a+r)*u,t[10]=(o+i)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i*2*c,t[15]=0,t}function Nt(t,e,n,r,a){var i,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(i=1/(r-a),t[10]=(a+r)*i,t[14]=2*a*r*i):(t[10]=-1,t[14]=-2*r),t}function Ft(t,e,n,r){var a=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(o+s),c=2/(a+i);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-s)*u*.5,t[9]=(a-i)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function Bt(t,e,n,r,a,i,o){var s=1/(e-n),u=1/(r-a),c=1/(i-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(a+r)*u,t[14]=(o+i)*c,t[15]=1,t}function Ht(t,e,n,r){var a,i,o,s,u,c,d,l,h,f,g=e[0],p=e[1],v=e[2],m=r[0],w=r[1],b=r[2],y=n[0],M=n[1],S=n[2];return Math.abs(g-y)<it&&Math.abs(p-M)<it&&Math.abs(v-S)<it?ft(t):(d=g-y,l=p-M,h=v-S,a=w*(h*=f=1/Math.hypot(d,l,h))-b*(l*=f),i=b*(d*=f)-m*h,o=m*l-w*d,(f=Math.hypot(a,i,o))?(a*=f=1/f,i*=f,o*=f):(a=0,i=0,o=0),s=l*o-h*i,u=h*a-d*o,c=d*i-l*a,(f=Math.hypot(s,u,c))?(s*=f=1/f,u*=f,c*=f):(s=0,u=0,c=0),t[0]=a,t[1]=s,t[2]=d,t[3]=0,t[4]=i,t[5]=u,t[6]=l,t[7]=0,t[8]=o,t[9]=c,t[10]=h,t[11]=0,t[12]=-(a*g+i*p+o*v),t[13]=-(s*g+u*p+c*v),t[14]=-(d*g+l*p+h*v),t[15]=1,t)}function Gt(t,e,n,r){var a=e[0],i=e[1],o=e[2],s=r[0],u=r[1],c=r[2],d=a-n[0],l=i-n[1],h=o-n[2],f=d*d+l*l+h*h;f>0&&(d*=f=1/Math.sqrt(f),l*=f,h*=f);var g=u*h-c*l,p=c*d-s*h,v=s*l-u*d;return(f=g*g+p*p+v*v)>0&&(g*=f=1/Math.sqrt(f),p*=f,v*=f),t[0]=g,t[1]=p,t[2]=v,t[3]=0,t[4]=l*v-h*p,t[5]=h*g-d*v,t[6]=d*p-l*g,t[7]=0,t[8]=d,t[9]=l,t[10]=h,t[11]=0,t[12]=a,t[13]=i,t[14]=o,t[15]=1,t}function _t(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Yt(t){return Math.hypot(t[0],t[1],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function zt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function Qt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Xt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function Kt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function Zt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Jt(t,e){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],u=t[6],c=t[7],d=t[8],l=t[9],h=t[10],f=t[11],g=t[12],p=t[13],v=t[14],m=t[15],w=e[0],b=e[1],y=e[2],M=e[3],S=e[4],x=e[5],C=e[6],k=e[7],T=e[8],R=e[9],W=e[10],D=e[11],P=e[12],I=e[13],E=e[14],O=e[15];return Math.abs(n-w)<=it*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(r-b)<=it*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(a-y)<=it*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(i-M)<=it*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(o-S)<=it*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-x)<=it*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(u-C)<=it*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(c-k)<=it*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(d-T)<=it*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(l-R)<=it*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(h-W)<=it*Math.max(1,Math.abs(h),Math.abs(W))&&Math.abs(f-D)<=it*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(g-P)<=it*Math.max(1,Math.abs(g),Math.abs(P))&&Math.abs(p-I)<=it*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(v-E)<=it*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(m-O)<=it*Math.max(1,Math.abs(m),Math.abs(O))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var $t=wt,te=Qt;function ee(){var t=new ot(3);return ot!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ne(t){var e=new ot(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function re(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function ae(t,e,n){var r=new ot(3);return r[0]=t,r[1]=e,r[2]=n,r}function ie(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function oe(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function se(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function ue(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function ce(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function de(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function le(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function he(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function fe(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function ge(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function pe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ve(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function me(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function we(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return Math.hypot(n,r,a)}function be(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return n*n+r*r+a*a}function ye(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function Me(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Se(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function xe(t,e){var n=e[0],r=e[1],a=e[2],i=n*n+r*r+a*a;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Ce(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ke(t,e,n){var r=e[0],a=e[1],i=e[2],o=n[0],s=n[1],u=n[2];return t[0]=a*u-i*s,t[1]=i*o-r*u,t[2]=r*s-a*o,t}function Te(t,e,n,r){var a=e[0],i=e[1],o=e[2];return t[0]=a+r*(n[0]-a),t[1]=i+r*(n[1]-i),t[2]=o+r*(n[2]-o),t}function Re(t,e,n,r,a,i){var o=i*i,s=o*(2*i-3)+1,u=o*(i-2)+i,c=o*(i-1),d=o*(3-2*i);return t[0]=e[0]*s+n[0]*u+r[0]*c+a[0]*d,t[1]=e[1]*s+n[1]*u+r[1]*c+a[1]*d,t[2]=e[2]*s+n[2]*u+r[2]*c+a[2]*d,t}function We(t,e,n,r,a,i){var o=1-i,s=o*o,u=i*i,c=s*o,d=3*i*s,l=3*u*o,h=u*i;return t[0]=e[0]*c+n[0]*d+r[0]*l+a[0]*h,t[1]=e[1]*c+n[1]*d+r[1]*l+a[1]*h,t[2]=e[2]*c+n[2]*d+r[2]*l+a[2]*h,t}function De(t,e){e=e||1;var n=2*st()*Math.PI,r=2*st()-1,a=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*a,t[1]=Math.sin(n)*a,t[2]=r*e,t}function Pe(t,e,n){var r=e[0],a=e[1],i=e[2],o=n[3]*r+n[7]*a+n[11]*i+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*a+n[8]*i+n[12])/o,t[1]=(n[1]*r+n[5]*a+n[9]*i+n[13])/o,t[2]=(n[2]*r+n[6]*a+n[10]*i+n[14])/o,t}function Ie(t,e,n){var r=e[0],a=e[1],i=e[2];return t[0]=r*n[0]+a*n[3]+i*n[6],t[1]=r*n[1]+a*n[4]+i*n[7],t[2]=r*n[2]+a*n[5]+i*n[8],t}function Ee(t,e,n){var r=n[0],a=n[1],i=n[2],o=n[3],s=e[0],u=e[1],c=e[2],d=a*c-i*u,l=i*s-r*c,h=r*u-a*s,f=a*h-i*l,g=i*d-r*h,p=r*l-a*d,v=2*o;return d*=v,l*=v,h*=v,f*=2,g*=2,p*=2,t[0]=s+d+f,t[1]=u+l+g,t[2]=c+h+p,t}function Oe(t,e,n,r){var a=[],i=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],i[0]=a[0],i[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),i[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function je(t,e,n,r){var a=[],i=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],i[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),i[1]=a[1],i[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function qe(t,e,n,r){var a=[],i=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],i[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),i[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),i[2]=a[2],t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function Ae(t,e){var n=ae(t[0],t[1],t[2]),r=ae(e[0],e[1],e[2]);xe(n,n),xe(r,r);var a=Ce(n,r);return a>1?0:a<-1?Math.PI:Math.acos(a)}function Le(t){return t[0]=0,t[1]=0,t[2]=0,t}function Ue(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Ve(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Ne(t,e){var n=t[0],r=t[1],a=t[2],i=e[0],o=e[1],s=e[2];return Math.abs(n-i)<=it*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=it*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-s)<=it*Math.max(1,Math.abs(a),Math.abs(s))}var Fe,Be=ue,He=ce,Ge=de,_e=we,Ye=be,ze=re,Qe=ye,Xe=(Fe=ee(),function(t,e,n,r,a,i){var o,s;for(e||(e=3),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,o=n;o<s;o+=e)Fe[0]=t[o],Fe[1]=t[o+1],Fe[2]=t[o+2],a(Fe,Fe,i),t[o]=Fe[0],t[o+1]=Fe[1],t[o+2]=Fe[2];return t});function Ke(t){var e=t[0],n=t[1],r=t[2],a=t[3];return Math.hypot(e,n,r,a)}function Ze(t){var e=t[0],n=t[1],r=t[2],a=t[3];return e*e+n*n+r*r+a*a}!function(){var t,e=(t=new ot(4),ot!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function Je(){var t=new ot(4);return ot!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function $e(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function tn(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function en(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>it?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function nn(t,e){var n=On(t,e);return Math.acos(2*n*n-1)}function rn(t,e,n){var r=e[0],a=e[1],i=e[2],o=e[3],s=n[0],u=n[1],c=n[2],d=n[3];return t[0]=r*d+o*s+a*c-i*u,t[1]=a*d+o*u+i*s-r*c,t[2]=i*d+o*c+r*u-a*s,t[3]=o*d-r*s-a*u-i*c,t}function an(t,e,n){n*=.5;var r=e[0],a=e[1],i=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=a*u+i*s,t[2]=i*u-a*s,t[3]=o*u-r*s,t}function on(t,e,n){n*=.5;var r=e[0],a=e[1],i=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-i*s,t[1]=a*u+o*s,t[2]=i*u+r*s,t[3]=o*u-a*s,t}function sn(t,e,n){n*=.5;var r=e[0],a=e[1],i=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+a*s,t[1]=a*u-r*s,t[2]=i*u+o*s,t[3]=o*u-i*s,t}function un(t,e){var n=e[0],r=e[1],a=e[2];return t[0]=n,t[1]=r,t[2]=a,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),t}function cn(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=Math.sqrt(n*n+r*r+a*a),s=Math.exp(i),u=o>0?s*Math.sin(o)/o:0;return t[0]=n*u,t[1]=r*u,t[2]=a*u,t[3]=s*Math.cos(o),t}function dn(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=Math.sqrt(n*n+r*r+a*a),s=o>0?Math.atan2(o,i)/o:0;return t[0]=n*s,t[1]=r*s,t[2]=a*s,t[3]=.5*Math.log(n*n+r*r+a*a+i*i),t}function ln(t,e,n){return dn(t,e),En(t,t,n),cn(t,t),t}function hn(t,e,n,r){var a,i,o,s,u,c=e[0],d=e[1],l=e[2],h=e[3],f=n[0],g=n[1],p=n[2],v=n[3];return(i=c*f+d*g+l*p+h*v)<0&&(i=-i,f=-f,g=-g,p=-p,v=-v),1-i>it?(a=Math.acos(i),o=Math.sin(a),s=Math.sin((1-r)*a)/o,u=Math.sin(r*a)/o):(s=1-r,u=r),t[0]=s*c+u*f,t[1]=s*d+u*g,t[2]=s*l+u*p,t[3]=s*h+u*v,t}function fn(t){var e=st(),n=st(),r=st(),a=Math.sqrt(1-e),i=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*n),t[1]=a*Math.cos(2*Math.PI*n),t[2]=i*Math.sin(2*Math.PI*r),t[3]=i*Math.cos(2*Math.PI*r),t}function gn(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=n*n+r*r+a*a+i*i,s=o?1/o:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-a*s,t[3]=i*s,t}function pn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function vn(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var i=(a+1)%3,o=(a+2)%3;n=Math.sqrt(e[3*a+a]-e[3*i+i]-e[3*o+o]+1),t[a]=.5*n,n=.5/n,t[3]=(e[3*i+o]-e[3*o+i])*n,t[i]=(e[3*i+a]+e[3*a+i])*n,t[o]=(e[3*o+a]+e[3*a+o])*n}return t}function mn(t,e,n,r){var a=.5*Math.PI/180;e*=a,n*=a,r*=a;var i=Math.sin(e),o=Math.cos(e),s=Math.sin(n),u=Math.cos(n),c=Math.sin(r),d=Math.cos(r);return t[0]=i*u*d-o*s*c,t[1]=o*s*d+i*u*c,t[2]=o*u*c-i*s*d,t[3]=o*u*d+i*s*c,t}function wn(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var bn,yn,Mn,Sn,xn,Cn,kn,Tn=function(t){var e=new ot(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Rn=function(t,e,n,r){var a=new ot(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a},Wn=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Dn=function(t,e,n,r,a){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t},Pn=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},In=rn,En=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},On=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},jn=function(t,e,n,r){var a=e[0],i=e[1],o=e[2],s=e[3];return t[0]=a+r*(n[0]-a),t[1]=i+r*(n[1]-i),t[2]=o+r*(n[2]-o),t[3]=s+r*(n[3]-s),t},qn=Ke,An=qn,Ln=Ze,Un=Ln,Vn=function(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],o=n*n+r*r+a*a+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=a*o,t[3]=i*o,t},Nn=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Fn=function(t,e){var n=t[0],r=t[1],a=t[2],i=t[3],o=e[0],s=e[1],u=e[2],c=e[3];return Math.abs(n-o)<=it*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=it*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-u)<=it*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(i-c)<=it*Math.max(1,Math.abs(i),Math.abs(c))},Bn=(bn=ee(),yn=ae(1,0,0),Mn=ae(0,1,0),function(t,e,n){var r=Ce(e,n);return r<-.999999?(ke(bn,yn,e),ze(bn)<1e-6&&ke(bn,Mn,e),xe(bn,bn),tn(t,bn,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ke(bn,e,n),t[0]=bn[0],t[1]=bn[1],t[2]=bn[2],t[3]=1+r,Vn(t,t))}),Hn=(Sn=Je(),xn=Je(),function(t,e,n,r,a,i){return hn(Sn,e,a,i),hn(xn,n,r,i),hn(t,Sn,xn,2*i*(1-i)),t}),Gn=(Cn=new ot(9),ot!=Float32Array&&(Cn[1]=0,Cn[2]=0,Cn[3]=0,Cn[5]=0,Cn[6]=0,Cn[7]=0),Cn[0]=1,Cn[4]=1,Cn[8]=1,kn=Cn,function(t,e,n,r){return kn[0]=n[0],kn[3]=n[1],kn[6]=n[2],kn[1]=r[0],kn[4]=r[1],kn[7]=r[2],kn[2]=-e[0],kn[5]=-e[1],kn[8]=-e[2],Vn(t,vn(t,kn))});function _n(){var t=new ot(2);return ot!=Float32Array&&(t[0]=0,t[1]=0),t}function Yn(t){var e=new ot(2);return e[0]=t[0],e[1]=t[1],e}function zn(t,e){var n=new ot(2);return n[0]=t,n[1]=e,n}function Qn(t,e){return t[0]=e[0],t[1]=e[1],t}function Xn(t,e,n){return t[0]=e,t[1]=n,t}function Kn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function Zn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Jn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function $n(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function tr(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function er(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function nr(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function rr(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function ar(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function ir(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function or(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function sr(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function ur(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function cr(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function dr(t){var e=t[0],n=t[1];return e*e+n*n}function lr(t,e){return t[0]=-e[0],t[1]=-e[1],t}function hr(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function fr(t,e){var n=e[0],r=e[1],a=n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t}function gr(t,e){return t[0]*e[0]+t[1]*e[1]}function pr(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function vr(t,e,n,r){var a=e[0],i=e[1];return t[0]=a+r*(n[0]-a),t[1]=i+r*(n[1]-i),t}function mr(t,e){e=e||1;var n=2*st()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function wr(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[2]*a,t[1]=n[1]*r+n[3]*a,t}function br(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[2]*a+n[4],t[1]=n[1]*r+n[3]*a+n[5],t}function yr(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[3]*a+n[6],t[1]=n[1]*r+n[4]*a+n[7],t}function Mr(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[4]*a+n[12],t[1]=n[1]*r+n[5]*a+n[13],t}function Sr(t,e,n,r){var a=e[0]-n[0],i=e[1]-n[1],o=Math.sin(r),s=Math.cos(r);return t[0]=a*s-i*o+n[0],t[1]=a*o+i*s+n[1],t}function xr(t,e){var n=t[0],r=t[1],a=e[0],i=e[1],o=n*n+r*r;o>0&&(o=1/Math.sqrt(o));var s=a*a+i*i;s>0&&(s=1/Math.sqrt(s));var u=(n*a+r*i)*o*s;return u>1?0:u<-1?Math.PI:Math.acos(u)}function Cr(t){return t[0]=0,t[1]=0,t}function kr(t){return"vec2("+t[0]+", "+t[1]+")"}function Tr(t,e){return t[0]===e[0]&&t[1]===e[1]}function Rr(t,e){var n=t[0],r=t[1],a=e[0],i=e[1];return Math.abs(n-a)<=it*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-i)<=it*Math.max(1,Math.abs(r),Math.abs(i))}var Wr=cr,Dr=Zn,Pr=Jn,Ir=$n,Er=sr,Or=ur,jr=dr,qr=function(){var t=_n();return function(e,n,r,a,i,o){var s,u;for(n||(n=2),r||(r=0),u=a?Math.min(a*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],i(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}}();function Ar(t){return t*Math.PI/180}var Lr={VIEWPORT_ROTATED:"viewportRotated"};function Ur(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Vr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ur(Object(n),!0).forEach((function(e){T()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ur(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Nr(t){if("number"!=typeof t||t!==Number(t)||!Number.isFinite(t))throw"Invalid number ".concat(t)}var Fr=function t(e){var n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;g()(this,t),T()(this,"_state",null),T()(this,"eventWindow",void 0),T()(this,"getEventWindow",(function(){return n.eventWindow})),T()(this,"_rotate",(function(t,e,o,s){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Nr(o),Nr(s),Nr(u);var c=[];a.cross(c,t,e),a.normalize(c,c);var d=t,l=[],h=[],f=r.create();if(r.rotate(f,f,Ar(s),d),r.rotate(f,f,Ar(o),c),a.transformMat4(l,e,f),a.transformMat4(h,t,f),0!==u){var g=i.create();i.setAxisAngle(g,l,Ar(-u)),i.normalize(g,g),a.transformQuat(h,h,g)}n._state.cache.sliceNormal=l,n._state.cache.viewUp=h;var p=new CustomEvent(Lr.VIEWPORT_ROTATED,{detail:{sliceNormal:l,sliceViewUp:h,dThetaX:o,dThetaY:s,dThetaZ:u},bubbles:!0,cancelable:!0});n.eventWindow.dispatchEvent(p)})),T()(this,"rotateAbsolute",(function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n._rotate(n._state.viewUp,n._state.sliceNormal,t,e,r)})),T()(this,"rotateRelative",(function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n._rotate(n._state.cache.viewUp,n._state.cache.sliceNormal,t,e,r)})),T()(this,"setOrientation",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,1,0];n._state.sliceNormal=h()(t),n._state.viewUp=h()(e),n._state.cache.sliceNormal=h()(t),n._state.cache.viewUp=h()(e)})),T()(this,"getViewUp",(function(){return n._state.viewUp})),T()(this,"getSliceNormal",(function(){return n._state.sliceNormal})),T()(this,"getCurrentViewUp",(function(){return n._state.cache.viewUp})),T()(this,"getCurrentSliceNormal",(function(){return n._state.cache.sliceNormal})),T()(this,"getReadOnlyViewPort",(function(){var t=JSON.parse(JSON.stringify(n._state));return Object.freeze(t),t})),this.eventWindow=e,null===this._state?this._state={viewUp:[0,1,0],sliceNormal:[0,0,1]}:this._state=JSON.parse(JSON.stringify(o)),this._state.cache=Vr({},this._state)},Br=at.a.States;function Hr(t,e,n){return t<e?e:t>n?n:t}function Gr(t,e){e.classHierarchy.push("vtkInteractorStyleMPRSlice"),e.trackballManipulator=Q.a.newInstance({button:1}),e.panManipulator=K.a.newInstance({button:2}),e.zoomManipulator=J.a.newInstance({button:3}),e.scrollManipulator=tt.a.newInstance({scrollEnabled:!0,dragEnabled:!1});var n={sliceNormal:[0,0,0],sliceRange:[0,0],sliceCenter:[]};function r(t){i(t.detail.sliceNormal),a(t.detail.sliceViewUp)}function a(t){var n=e.interactor.getCurrentRenderer().getActiveCamera();n.setViewUp.apply(n,h()(t))}function i(n){var r=e.interactor.getCurrentRenderer().getActiveCamera(),a=h()(n);if(e.volumeActor){B.a.normalize(a);var i=r.getFocalPoint(),o=r.getDistance(),s=r.getViewAngle();if(!function(t){var e=t.getDistance();return"number"==typeof e&&e===Number(e)&&Number.isFinite(e)}(r)){var u=e.volumeActor.getMapper().getBounds(),c=Math.sqrt(B.a.distance2BetweenPoints([u[0],u[2],u[4]],[u[1],u[3],u[5]]));i=[(u[0]+u[1])/2,(u[2]+u[3])/2,(u[4]+u[5])/2],s=90,o=c/(2*Math.tan(s/360*Math.PI))}var d=[i[0]-a[0]*o,i[1]-a[1]*o,i[2]-a[2]*o];r.setPosition.apply(r,d),r.setDistance(o),r.setDirectionOfProjection.apply(r,h()(a)),r.setViewAngle(s),r.setThicknessFromFocalPoint(e.slabThickness),t.setCenterOfRotation(i)}}t.updateScrollManipulator=function(){var n=t.getSliceRange();e.scrollManipulator.removeScrollListener(),e.scrollManipulator.setScrollListener(n[0],n[1],1,t.getSlice,t.scrollToSlice)},t.setViewport=function(t){e.viewportData&&e.viewportData.getEventWindow().removeEventListener(Lr.VIEWPORT_ROTATED,r);e.viewportData=t,e.scrollManipulator.setViewportData&&e.scrollManipulator.setViewportData(t),t&&(i(t.getCurrentSliceNormal()),a(t.getCurrentViewUp()),t.getEventWindow().addEventListener(Lr.VIEWPORT_ROTATED,r))},t.getViewport=function(){return e.viewportData};var o=null,s=null,u=t.setInteractor;function c(n){var r=e.apis,a=e.apiIndex;if(r&&r[a]&&"VIEW2D"===r[a].type){t.startPan();var i=r[a];i.svgWidgets.crosshairsWidget&&i.svgWidgets.crosshairsWidget.updateCrosshairForApi(i),i.svgWidgets.rotatableCrosshairsWidget&&d()}}function d(){var t=e.apis,n=e.apiIndex,r=t[n],a=r.svgWidgets.rotatableCrosshairsWidget,i=r.get("cachedCrosshairWorldPosition");a.moveCrosshairs(i,t,n)}t.setInteractor=function(n){if(u(n),o&&(o.unsubscribe(),o=null),s&&(s.unsubscribe(),s=null),n){var r=n.getCurrentRenderer().getActiveCamera();o=r.onModified((function(){t.updateScrollManipulator(),t.modified()})),s=n.onAnimation((function(){r.setThicknessFromFocalPoint(e.slabThickness)}));var a=e.interactor.getContainer();t.setViewport(new Fr(a))}else t.setViewport(null)},t.handleMiddleButtonPress=N.a.chain(t.handleMiddleButtonPress,c),t.handleRightButtonPress=N.a.chain(t.handleRightButtonPress,c);var l=t.handleMouseMove;function f(n,r){if(e.state===Br.IS_PAN){t.endPan();var a=e.apis[e.apiIndex];a.svgWidgets.crosshairsWidget&&a.svgWidgets.crosshairsWidget.updateCrosshairForApi(a),a.svgWidgets.rotatableCrosshairsWidget&&d()}n()}t.handleMouseMove=function(t){if(l&&l(t),e.apis[e.apiIndex].genericRenderWindow.getRenderer().getActiveCamera().setThicknessFromFocalPoint(e.slabThickness),e.state===Br.IS_PAN){var n=e.apis[e.apiIndex];n.svgWidgets.crosshairsWidget&&n.svgWidgets.crosshairsWidget.updateCrosshairForApi(n),n.svgWidgets.rotatableCrosshairsWidget&&d()}},t.superHandleMiddleButtonRelease=t.handleMiddleButtonRelease,t.handleMiddleButtonRelease=function(e){f(t.superHandleMiddleButtonRelease)},t.superHandleRightButtonRelease=t.handleRightButtonRelease,t.handleRightButtonRelease=function(e){f(t.superHandleRightButtonRelease)},t.setVolumeActor=function(n){e.volumeActor=n;var r=e.interactor.getCurrentRenderer().getActiveCamera();if(n){r.setFreezeFocalPoint(!0);var o=t.getViewport();o&&(i(o.getCurrentSliceNormal()),a(o.getCurrentViewUp())),t.updateScrollManipulator()}else r.setFreezeFocalPoint(!1)},t.getSlice=function(){var n=e.interactor.getCurrentRenderer().getActiveCamera(),r=t.getSliceNormal(),a=G.a.buildFromDegree().identity().rotateFromDirections(r,[1,0,0]),i=n.getFocalPoint();return a.apply(i),i[0]},t.scrollToSlice=function(e){var n=new CustomEvent("vtkscrollevent",{detail:{uid:t.getUid()}});window.dispatchEvent(n);var r=t.setSlice(e),a=t.getOnScroll();a&&a({slicePoint:r})},e.onScroll=function(){var t=e.apis,n=e.apiIndex;if(t&&t[n]&&"VIEW2D"===t[n].type){var r=t[n];if(!r.svgWidgets.crosshairsWidget&&!r.svgWidgets.rotatableCrosshairsWidget)return;var a=r.genericRenderWindow.getRenderer(),i=r.get("cachedCrosshairWorldPosition");if(void 0===i)return;var o=nt.a.newInstance();o.setCoordinateSystemToWorld(),o.setValue.apply(o,h()(i));var s=o.getComputedDoubleDisplayValue(a),u=nt.a.newInstance();u.setCoordinateSystemToDisplay(),u.setValue(s[0],s[1],0);for(var c=u.getComputedWorldValue(a),d=a.getActiveCamera().getDirectionOfProjection(),l=r.getSlabThickness()/2,f=0;f<c.length;f++)c[f]+=l*d[f];r.svgWidgets.crosshairsWidget&&r.svgWidgets.crosshairsWidget.moveCrosshairs(c,t,n),r.svgWidgets.rotatableCrosshairsWidget&&r.svgWidgets.rotatableCrosshairsWidget.moveCrosshairs(c,t,n)}},t.setSlice=function(r){var a=e.interactor.getCurrentRenderer().getActiveCamera();if(e.volumeActor){var i=t.getSliceRange(),o=e.volumeActor.getMapper().getBounds(),s=Hr.apply(void 0,[r].concat(h()(i))),u=[0,0,0];if(n.sliceCenter.length){var c=a.getFocalPoint();B.a.subtract(c,n.sliceCenter,u)}var d=[(o[0]+o[1])/2,(o[2]+o[3])/2,(o[4]+o[5])/2],l=a.getDistance(),f=a.getDirectionOfProjection();B.a.normalize(f);var g=(i[1]+i[0])/2,p=[d[0]-f[0]*g,d[1]-f[1]*g,d[2]-f[2]*g],v=[p[0]+f[0]*s,p[1]+f[1]*s,p[2]+f[2]*s];n.sliceCenter=[].concat(v);var m=[v[0]-f[0]*l,v[1]-f[1]*l,v[2]-f[2]*l];return B.a.add(v,u,v),B.a.add(m,u,m),a.setPosition.apply(a,m),a.setFocalPoint.apply(a,v),v}},t.getSliceRange=function(){if(e.volumeActor){var r=t.getSliceNormal();if(r[0]===n.sliceNormal[0]&&r[1]===n.sliceNormal[1]&&r[2]===n.sliceNormal[2])return n.sliceRange;var a=function(t){return[[t[0],t[2],t[4]],[t[0],t[2],t[5]],[t[0],t[3],t[4]],[t[0],t[3],t[5]],[t[1],t[2],t[4]],[t[1],t[2],t[5]],[t[1],t[3],t[4]],[t[1],t[3],t[5]]]}(e.volumeActor.getMapper().getBounds()),i=G.a.buildFromDegree().identity().rotateFromDirections(r,[1,0,0]);a.forEach((function(t){return i.apply(t)}));for(var o=1/0,s=-1/0,u=0;u<8;u++){var c=a[u][0];c>s&&(s=c),c<o&&(o=c)}return n.sliceNormal=r,n.sliceRange=[o,s],n.sliceRange}return[0,0]},t.getSliceNormal=function(){return e.volumeActor&&e.interactor?e.interactor.getCurrentRenderer().getActiveCamera().getDirectionOfProjection():[0,0,0]},t.setSliceNormal=function(){for(var e=t.getViewport(),n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];e&&e.setOrientation(r,e.getCurrentViewUp()),i(r)},t.getViewUp=function(){return e.volumeActor&&e.interactor?e.interactor.getCurrentRenderer().getActiveCamera().getViewUp():[0,0,0]},t.setViewUp=function(){for(var e=t.getViewport(),n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e&&e.setOrientation(e.getSliceNormal(),r),a(r)},t.setSliceOrientation=function(e,n){var r=t.getViewport();r&&r.setOrientation(e,n),i(e),a(n)},t.setSlabThickness=function(t){e.slabThickness=t,e.interactor.getCurrentRenderer().getActiveCamera().setThicknessFromFocalPoint(t)},t.setUid=function(t){e.uid=t},t.getUid=function(){return e.uid},t.removeAllMouseManipulators(),t.addMouseManipulator(e.trackballManipulator),t.addMouseManipulator(e.panManipulator),t.addMouseManipulator(e.zoomManipulator),t.addMouseManipulator(e.scrollManipulator),t.updateScrollManipulator()}var _r={slabThickness:.1,uid:""};function Yr(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,_r,n),Y.a.extend(t,e,n),N.a.setGet(t,e,["onScroll"]),N.a.get(t,e,["slabThickness","volumeActor","apis","apiIndex"]),Gr(t,e)}var zr=N.a.newInstance(Yr,"vtkInteractorStyleMPRSlice"),Qr=Object.assign({newInstance:zr,extend:Yr});var Xr=n(19),Kr=n.n(Xr),Zr=n(20),Jr=n.n(Zr),$r=N.a.vtkErrorMacro,ta=1;function ea(t,e){var n,r;e.classHierarchy.push("vtkSVGWidgetManager"),e.widgetId="vtkSVGWidgetManager-".concat(ta++),e.svgRootNode=(n=e.widgetId,(r=document.createElement("svg")).setAttribute("id",n),r.setAttribute("style","position: absolute; top: 0; left: 0; width: 100%; height: 100%;"),r.setAttribute("version","1.1"),r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r),e.widgets=[],t.setRenderer=function(n){var r=n.getRenderWindow().getInteractor();e.openGLRenderWindow=r.getView(),t.setContainer(e.openGLRenderWindow.getReferenceByName("el"))},t.setContainer=function(n){e.container&&e.container!==n&&(e.svgRootNode.parentNode===e.container?e.container.removeChild(e.svgRootNode):$r("Error: SVG parent node does not match container")),e.container!==n&&(e.container=n,e.container&&e.container.appendChild(e.svgRootNode),t.modified())},t.getSize=function(){return e.openGLRenderWindow.getSize()},t.addWidget=function(n){-1===e.widgets.indexOf(n)&&e.widgets.push(n),t.render()},t.removeWidget=function(n){var r=n.getWidgetId(),a=e.svgRootNode.querySelector("#".concat(r));e.svgRootNode.removeChild(a);var i=e.widgets.indexOf(n);-1!==i&&e.widgets.splice(i,1),t.render()},t.render=function(){e.svgRootNode&&requestAnimationFrame((function(){var n=e.scale,r=t.getSize(),a=d()(r,2),i=a[0],o=a[1];e.svgRootNode.setAttribute("viewBox","0 0 ".concat(i*n," ").concat(o*n)),e.svgRootNode.setAttribute("width","".concat(i*n)),e.svgRootNode.setAttribute("height","".concat(o*n));for(var s=0;s<e.widgets.length;s++)e.widgets[s].render(e.svgRootNode,e.scale)}))}}var na={scale:.5};function ra(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,na,n),N.a.obj(t,e),N.a.get(t,e,["container"]),N.a.setGet(t,e,["scale"]),ea(t,e)}var aa={newInstance:N.a.newInstance(ra,"vtkSVGWidgetManager"),extend:ra};var ia={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function oa(t){return function(e){var n=e||{},r=n.width?String(n.width):t.defaultWidth;return t.formats[r]||t.formats[t.defaultWidth]}}var sa={date:oa({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:oa({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:oa({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},ua={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function ca(t){return function(e,n){var r,a=n||{};if("formatting"===(a.context?String(a.context):"standalone")&&t.formattingValues){var i=t.defaultFormattingWidth||t.defaultWidth,o=a.width?String(a.width):i;r=t.formattingValues[o]||t.formattingValues[i]}else{var s=t.defaultWidth,u=a.width?String(a.width):t.defaultWidth;r=t.values[u]||t.values[s]}return r[t.argumentCallback?t.argumentCallback(e):e]}}function da(t){return function(e,n){var r=String(e),a=n||{},i=a.width,o=i&&t.matchPatterns[i]||t.matchPatterns[t.defaultMatchWidth],s=r.match(o);if(!s)return null;var u,c=s[0],d=i&&t.parsePatterns[i]||t.parsePatterns[t.defaultParseWidth];return u="[object Array]"===Object.prototype.toString.call(d)?function(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return n}(d,(function(t){return t.test(r)})):function(t,e){for(var n in t)if(t.hasOwnProperty(n)&&e(t[n]))return n}(d,(function(t){return t.test(r)})),u=t.valueCallback?t.valueCallback(u):u,{value:u=a.valueCallback?a.valueCallback(u):u,rest:r.slice(c.length)}}}var la,ha={code:"en-US",formatDistance:function(t,e,n){var r;return n=n||{},r="string"==typeof ia[t]?ia[t]:1===e?ia[t].one:ia[t].other.replace("{{count}}",e),n.addSuffix?n.comparison>0?"in "+r:r+" ago":r},formatLong:sa,formatRelative:function(t,e,n,r){return ua[t]},localize:{ordinalNumber:function(t,e){var n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:ca({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:ca({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(t){return Number(t)-1}}),month:ca({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:ca({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:ca({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(la={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(t){return parseInt(t,10)}},function(t,e){var n=String(t),r=e||{},a=n.match(la.matchPattern);if(!a)return null;var i=a[0],o=n.match(la.parsePattern);if(!o)return null;var s=la.valueCallback?la.valueCallback(o[0]):o[0];return{value:s=r.valueCallback?r.valueCallback(s):s,rest:n.slice(i.length)}}),era:da({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:da({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:da({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:da({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:da({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function fa(t){if(null===t||!0===t||!1===t)return NaN;var e=Number(t);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function ga(t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var e=Object.prototype.toString.call(t);return t instanceof Date||"object"==typeof t&&"[object Date]"===e?new Date(t.getTime()):"number"==typeof t||"[object Number]"===e?new Date(t):("string"!=typeof t&&"[object String]"!==e||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}function pa(t,e){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");return function(t,e){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var n=ga(t).getTime(),r=fa(e);return new Date(n+r)}(t,-fa(e))}function va(t,e){if(null==t)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in e=e||{})e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function ma(t,e){switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}}function wa(t,e){switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}}var ba={p:wa,P:function(t,e){var n,r=t.match(/(P+)(p+)?/),a=r[1],i=r[2];if(!i)return ma(t,e);switch(a){case"P":n=e.dateTime({width:"short"});break;case"PP":n=e.dateTime({width:"medium"});break;case"PPP":n=e.dateTime({width:"long"});break;case"PPPP":default:n=e.dateTime({width:"full"})}return n.replace("{{date}}",ma(a,e)).replace("{{time}}",wa(i,e))}},ya=6e4;function Ma(t){var e=new Date(t.getTime()),n=Math.ceil(e.getTimezoneOffset());e.setSeconds(0,0);var r=e.getTime()%ya;return n*ya+r}var Sa=["D","DD"],xa=["YY","YYYY"];function Ca(t){return-1!==Sa.indexOf(t)}function ka(t){return-1!==xa.indexOf(t)}function Ta(t){if("YYYY"===t)throw new RangeError("Use `yyyy` instead of `YYYY` for formatting years; see: https://git.io/fxCyr");if("YY"===t)throw new RangeError("Use `yy` instead of `YY` for formatting years; see: https://git.io/fxCyr");if("D"===t)throw new RangeError("Use `d` instead of `D` for formatting days of the month; see: https://git.io/fxCyr");if("DD"===t)throw new RangeError("Use `dd` instead of `DD` for formatting days of the month; see: https://git.io/fxCyr")}function Ra(t,e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var n=e||{},r=n.locale,a=r&&r.options&&r.options.weekStartsOn,i=null==a?0:fa(a),o=null==n.weekStartsOn?i:fa(n.weekStartsOn);if(!(o>=0&&o<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var s=ga(t),u=s.getUTCDay(),c=(u<o?7:0)+u-o;return s.setUTCDate(s.getUTCDate()-c),s.setUTCHours(0,0,0,0),s}function Wa(t,e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var n=ga(t,e),r=n.getUTCFullYear(),a=e||{},i=a.locale,o=i&&i.options&&i.options.firstWeekContainsDate,s=null==o?1:fa(o),u=null==a.firstWeekContainsDate?s:fa(a.firstWeekContainsDate);if(!(u>=1&&u<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var c=new Date(0);c.setUTCFullYear(r+1,0,u),c.setUTCHours(0,0,0,0);var d=Ra(c,e),l=new Date(0);l.setUTCFullYear(r,0,u),l.setUTCHours(0,0,0,0);var h=Ra(l,e);return n.getTime()>=d.getTime()?r+1:n.getTime()>=h.getTime()?r:r-1}function Da(t,e,n){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var r=n||{},a=r.locale,i=a&&a.options&&a.options.weekStartsOn,o=null==i?0:fa(i),s=null==r.weekStartsOn?o:fa(r.weekStartsOn);if(!(s>=0&&s<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var u=ga(t),c=fa(e),d=((c%7+7)%7<s?7:0)+c-u.getUTCDay();return u.setUTCDate(u.getUTCDate()+d),u}function Pa(t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var e=ga(t),n=e.getUTCDay(),r=(n<1?7:0)+n-1;return e.setUTCDate(e.getUTCDate()-r),e.setUTCHours(0,0,0,0),e}function Ia(t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var e=ga(t),n=e.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var a=Pa(r),i=new Date(0);i.setUTCFullYear(n,0,4),i.setUTCHours(0,0,0,0);var o=Pa(i);return e.getTime()>=a.getTime()?n+1:e.getTime()>=o.getTime()?n:n-1}var Ea=6048e5;function Oa(t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var e=ga(t),n=Pa(e).getTime()-function(t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var e=Ia(t),n=new Date(0);return n.setUTCFullYear(e,0,4),n.setUTCHours(0,0,0,0),Pa(n)}(e).getTime();return Math.round(n/Ea)+1}var ja=6048e5;function qa(t,e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var n=ga(t),r=Ra(n,e).getTime()-function(t,e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var n=e||{},r=n.locale,a=r&&r.options&&r.options.firstWeekContainsDate,i=null==a?1:fa(a),o=null==n.firstWeekContainsDate?i:fa(n.firstWeekContainsDate),s=Wa(t,e),u=new Date(0);return u.setUTCFullYear(s,0,o),u.setUTCHours(0,0,0,0),Ra(u,e)}(n,e).getTime();return Math.round(r/ja)+1}var Aa=36e5,La=6e4,Ua=1e3,Va={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},Na=/^([+-])(\d{2})(\d{2})?|Z/,Fa=/^([+-])(\d{2})(\d{2})|Z/,Ba=/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,Ha=/^([+-])(\d{2}):(\d{2})|Z/,Ga=/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/;function _a(t,e,n){var r=e.match(t);if(!r)return null;var a=parseInt(r[0],10);return{value:n?n(a):a,rest:e.slice(r[0].length)}}function Ya(t,e){var n=e.match(t);if(!n)return null;if("Z"===n[0])return{value:0,rest:e.slice(1)};var r="+"===n[1]?1:-1,a=n[2]?parseInt(n[2],10):0,i=n[3]?parseInt(n[3],10):0,o=n[5]?parseInt(n[5],10):0;return{value:r*(a*Aa+i*La+o*Ua),rest:e.slice(n[0].length)}}function za(t,e){return _a(Va.anyDigitsSigned,t,e)}function Qa(t,e,n){switch(t){case 1:return _a(Va.singleDigit,e,n);case 2:return _a(Va.twoDigits,e,n);case 3:return _a(Va.threeDigits,e,n);case 4:return _a(Va.fourDigits,e,n);default:return _a(new RegExp("^\\d{1,"+t+"}"),e,n)}}function Xa(t,e,n){switch(t){case 1:return _a(Va.singleDigitSigned,e,n);case 2:return _a(Va.twoDigitsSigned,e,n);case 3:return _a(Va.threeDigitsSigned,e,n);case 4:return _a(Va.fourDigitsSigned,e,n);default:return _a(new RegExp("^-?\\d{1,"+t+"}"),e,n)}}function Ka(t){switch(t){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function Za(t,e){var n,r=e>0,a=r?e:1-e;if(a<=50)n=t||100;else{var i=a+50;n=t+100*Math.floor(i/100)-(t>=i%100?100:0)}return r?n:1-n}var Ja=[31,28,31,30,31,30,31,31,30,31,30,31],$a=[31,29,31,30,31,30,31,31,30,31,30,31];function ti(t){return t%400==0||t%4==0&&t%100!=0}var ei={G:{priority:140,parse:function(t,e,n,r){switch(e){case"G":case"GG":case"GGG":return n.era(t,{width:"abbreviated"})||n.era(t,{width:"narrow"});case"GGGGG":return n.era(t,{width:"narrow"});case"GGGG":default:return n.era(t,{width:"wide"})||n.era(t,{width:"abbreviated"})||n.era(t,{width:"narrow"})}},set:function(t,e,n,r){return e.era=n,t.setUTCFullYear(n,0,1),t.setUTCHours(0,0,0,0),t},incompatibleTokens:["R","u","t","T"]},y:{priority:130,parse:function(t,e,n,r){var a=function(t){return{year:t,isTwoDigitYear:"yy"===e}};switch(e){case"y":return Qa(4,t,a);case"yo":return n.ordinalNumber(t,{unit:"year",valueCallback:a});default:return Qa(e.length,t,a)}},validate:function(t,e,n){return e.isTwoDigitYear||e.year>0},set:function(t,e,n,r){var a=t.getUTCFullYear();if(n.isTwoDigitYear){var i=Za(n.year,a);return t.setUTCFullYear(i,0,1),t.setUTCHours(0,0,0,0),t}var o="era"in e&&1!==e.era?1-n.year:n.year;return t.setUTCFullYear(o,0,1),t.setUTCHours(0,0,0,0),t},incompatibleTokens:["Y","R","u","w","I","i","e","c","t","T"]},Y:{priority:130,parse:function(t,e,n,r){var a=function(t){return{year:t,isTwoDigitYear:"YY"===e}};switch(e){case"Y":return Qa(4,t,a);case"Yo":return n.ordinalNumber(t,{unit:"year",valueCallback:a});default:return Qa(e.length,t,a)}},validate:function(t,e,n){return e.isTwoDigitYear||e.year>0},set:function(t,e,n,r){var a=Wa(t,r);if(n.isTwoDigitYear){var i=Za(n.year,a);return t.setUTCFullYear(i,0,r.firstWeekContainsDate),t.setUTCHours(0,0,0,0),Ra(t,r)}var o="era"in e&&1!==e.era?1-n.year:n.year;return t.setUTCFullYear(o,0,r.firstWeekContainsDate),t.setUTCHours(0,0,0,0),Ra(t,r)},incompatibleTokens:["y","R","u","Q","q","M","L","I","d","D","i","t","T"]},R:{priority:130,parse:function(t,e,n,r){return Xa("R"===e?4:e.length,t)},set:function(t,e,n,r){var a=new Date(0);return a.setUTCFullYear(n,0,4),a.setUTCHours(0,0,0,0),Pa(a)},incompatibleTokens:["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]},u:{priority:130,parse:function(t,e,n,r){return Xa("u"===e?4:e.length,t)},set:function(t,e,n,r){return t.setUTCFullYear(n,0,1),t.setUTCHours(0,0,0,0),t},incompatibleTokens:["G","y","Y","R","w","I","i","e","c","t","T"]},Q:{priority:120,parse:function(t,e,n,r){switch(e){case"Q":case"QQ":return Qa(e.length,t);case"Qo":return n.ordinalNumber(t,{unit:"quarter"});case"QQQ":return n.quarter(t,{width:"abbreviated",context:"formatting"})||n.quarter(t,{width:"narrow",context:"formatting"});case"QQQQQ":return n.quarter(t,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(t,{width:"wide",context:"formatting"})||n.quarter(t,{width:"abbreviated",context:"formatting"})||n.quarter(t,{width:"narrow",context:"formatting"})}},validate:function(t,e,n){return e>=1&&e<=4},set:function(t,e,n,r){return t.setUTCMonth(3*(n-1),1),t.setUTCHours(0,0,0,0),t},incompatibleTokens:["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]},q:{priority:120,parse:function(t,e,n,r){switch(e){case"q":case"qq":return Qa(e.length,t);case"qo":return n.ordinalNumber(t,{unit:"quarter"});case"qqq":return n.quarter(t,{width:"abbreviated",context:"standalone"})||n.quarter(t,{width:"narrow",context:"standalone"});case"qqqqq":return n.quarter(t,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(t,{width:"wide",context:"standalone"})||n.quarter(t,{width:"abbreviated",context:"standalone"})||n.quarter(t,{width:"narrow",context:"standalone"})}},validate:function(t,e,n){return e>=1&&e<=4},set:function(t,e,n,r){return t.setUTCMonth(3*(n-1),1),t.setUTCHours(0,0,0,0),t},incompatibleTokens:["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]},M:{priority:110,parse:function(t,e,n,r){var a=function(t){return t-1};switch(e){case"M":return _a(Va.month,t,a);case"MM":return Qa(2,t,a);case"Mo":return n.ordinalNumber(t,{unit:"month",valueCallback:a});case"MMM":return n.month(t,{width:"abbreviated",context:"formatting"})||n.month(t,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(t,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(t,{width:"wide",context:"formatting"})||n.month(t,{width:"abbreviated",context:"formatting"})||n.month(t,{width:"narrow",context:"formatting"})}},validate:function(t,e,n){return e>=0&&e<=11},set:function(t,e,n,r){return t.setUTCMonth(n,1),t.setUTCHours(0,0,0,0),t},incompatibleTokens:["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]},L:{priority:110,parse:function(t,e,n,r){var a=function(t){return t-1};switch(e){case"L":return _a(Va.month,t,a);case"LL":return Qa(2,t,a);case"Lo":return n.ordinalNumber(t,{unit:"month",valueCallback:a});case"LLL":return n.month(t,{width:"abbreviated",context:"standalone"})||n.month(t,{width:"narrow",context:"standalone"});case"LLLLL":return n.month(t,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(t,{width:"wide",context:"standalone"})||n.month(t,{width:"abbreviated",context:"standalone"})||n.month(t,{width:"narrow",context:"standalone"})}},validate:function(t,e,n){return e>=0&&e<=11},set:function(t,e,n,r){return t.setUTCMonth(n,1),t.setUTCHours(0,0,0,0),t},incompatibleTokens:["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]},w:{priority:100,parse:function(t,e,n,r){switch(e){case"w":return _a(Va.week,t);case"wo":return n.ordinalNumber(t,{unit:"week"});default:return Qa(e.length,t)}},validate:function(t,e,n){return e>=1&&e<=53},set:function(t,e,n,r){return Ra(function(t,e,n){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var r=ga(t),a=fa(e),i=qa(r,n)-a;return r.setUTCDate(r.getUTCDate()-7*i),r}(t,n,r),r)},incompatibleTokens:["y","R","u","q","Q","M","L","I","d","D","i","t","T"]},I:{priority:100,parse:function(t,e,n,r){switch(e){case"I":return _a(Va.week,t);case"Io":return n.ordinalNumber(t,{unit:"week"});default:return Qa(e.length,t)}},validate:function(t,e,n){return e>=1&&e<=53},set:function(t,e,n,r){return Pa(function(t,e){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var n=ga(t),r=fa(e),a=Oa(n)-r;return n.setUTCDate(n.getUTCDate()-7*a),n}(t,n,r),r)},incompatibleTokens:["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]},d:{priority:90,parse:function(t,e,n,r){switch(e){case"d":return _a(Va.date,t);case"do":return n.ordinalNumber(t,{unit:"date"});default:return Qa(e.length,t)}},validate:function(t,e,n){var r=ti(t.getUTCFullYear()),a=t.getUTCMonth();return r?e>=1&&e<=$a[a]:e>=1&&e<=Ja[a]},set:function(t,e,n,r){return t.setUTCDate(n),t.setUTCHours(0,0,0,0),t},incompatibleTokens:["Y","R","q","Q","w","I","D","i","e","c","t","T"]},D:{priority:90,parse:function(t,e,n,r){switch(e){case"D":case"DD":return _a(Va.dayOfYear,t);case"Do":return n.ordinalNumber(t,{unit:"date"});default:return Qa(e.length,t)}},validate:function(t,e,n){return ti(t.getUTCFullYear())?e>=1&&e<=366:e>=1&&e<=365},set:function(t,e,n,r){return t.setUTCMonth(0,n),t.setUTCHours(0,0,0,0),t},incompatibleTokens:["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]},E:{priority:90,parse:function(t,e,n,r){switch(e){case"E":case"EE":case"EEE":return n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"});case"EEEEE":return n.day(t,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"});case"EEEE":default:return n.day(t,{width:"wide",context:"formatting"})||n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"})}},validate:function(t,e,n){return e>=0&&e<=6},set:function(t,e,n,r){return(t=Da(t,n,r)).setUTCHours(0,0,0,0),t},incompatibleTokens:["D","i","e","c","t","T"]},e:{priority:90,parse:function(t,e,n,r){var a=function(t){var e=7*Math.floor((t-1)/7);return(t+r.weekStartsOn+6)%7+e};switch(e){case"e":case"ee":return Qa(e.length,t,a);case"eo":return n.ordinalNumber(t,{unit:"day",valueCallback:a});case"eee":return n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"});case"eeeee":return n.day(t,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"});case"eeee":default:return n.day(t,{width:"wide",context:"formatting"})||n.day(t,{width:"abbreviated",context:"formatting"})||n.day(t,{width:"short",context:"formatting"})||n.day(t,{width:"narrow",context:"formatting"})}},validate:function(t,e,n){return e>=0&&e<=6},set:function(t,e,n,r){return(t=Da(t,n,r)).setUTCHours(0,0,0,0),t},incompatibleTokens:["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]},c:{priority:90,parse:function(t,e,n,r){var a=function(t){var e=7*Math.floor((t-1)/7);return(t+r.weekStartsOn+6)%7+e};switch(e){case"c":case"cc":return Qa(e.length,t,a);case"co":return n.ordinalNumber(t,{unit:"day",valueCallback:a});case"ccc":return n.day(t,{width:"abbreviated",context:"standalone"})||n.day(t,{width:"short",context:"standalone"})||n.day(t,{width:"narrow",context:"standalone"});case"ccccc":return n.day(t,{width:"narrow",context:"standalone"});case"cccccc":return n.day(t,{width:"short",context:"standalone"})||n.day(t,{width:"narrow",context:"standalone"});case"cccc":default:return n.day(t,{width:"wide",context:"standalone"})||n.day(t,{width:"abbreviated",context:"standalone"})||n.day(t,{width:"short",context:"standalone"})||n.day(t,{width:"narrow",context:"standalone"})}},validate:function(t,e,n){return e>=0&&e<=6},set:function(t,e,n,r){return(t=Da(t,n,r)).setUTCHours(0,0,0,0),t},incompatibleTokens:["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]},i:{priority:90,parse:function(t,e,n,r){var a=function(t){return 0===t?7:t};switch(e){case"i":case"ii":return Qa(e.length,t);case"io":return n.ordinalNumber(t,{unit:"day"});case"iii":return n.day(t,{width:"abbreviated",context:"formatting",valueCallback:a})||n.day(t,{width:"short",context:"formatting",valueCallback:a})||n.day(t,{width:"narrow",context:"formatting",valueCallback:a});case"iiiii":return n.day(t,{width:"narrow",context:"formatting",valueCallback:a});case"iiiiii":return n.day(t,{width:"short",context:"formatting",valueCallback:a})||n.day(t,{width:"narrow",context:"formatting",valueCallback:a});case"iiii":default:return n.day(t,{width:"wide",context:"formatting",valueCallback:a})||n.day(t,{width:"abbreviated",context:"formatting",valueCallback:a})||n.day(t,{width:"short",context:"formatting",valueCallback:a})||n.day(t,{width:"narrow",context:"formatting",valueCallback:a})}},validate:function(t,e,n){return e>=1&&e<=7},set:function(t,e,n,r){return(t=function(t,e){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var n=fa(e);n%7==0&&(n-=7);var r=ga(t),a=((n%7+7)%7<1?7:0)+n-r.getUTCDay();return r.setUTCDate(r.getUTCDate()+a),r}(t,n,r)).setUTCHours(0,0,0,0),t},incompatibleTokens:["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]},a:{priority:80,parse:function(t,e,n,r){switch(e){case"a":case"aa":case"aaa":return n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"});case"aaaaa":return n.dayPeriod(t,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(t,{width:"wide",context:"formatting"})||n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"})}},set:function(t,e,n,r){return t.setUTCHours(Ka(n),0,0,0),t},incompatibleTokens:["b","B","H","K","k","t","T"]},b:{priority:80,parse:function(t,e,n,r){switch(e){case"b":case"bb":case"bbb":return n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"});case"bbbbb":return n.dayPeriod(t,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(t,{width:"wide",context:"formatting"})||n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"})}},set:function(t,e,n,r){return t.setUTCHours(Ka(n),0,0,0),t},incompatibleTokens:["a","B","H","K","k","t","T"]},B:{priority:80,parse:function(t,e,n,r){switch(e){case"B":case"BB":case"BBB":return n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"});case"BBBBB":return n.dayPeriod(t,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(t,{width:"wide",context:"formatting"})||n.dayPeriod(t,{width:"abbreviated",context:"formatting"})||n.dayPeriod(t,{width:"narrow",context:"formatting"})}},set:function(t,e,n,r){return t.setUTCHours(Ka(n),0,0,0),t},incompatibleTokens:["a","b","t","T"]},h:{priority:70,parse:function(t,e,n,r){switch(e){case"h":return _a(Va.hour12h,t);case"ho":return n.ordinalNumber(t,{unit:"hour"});default:return Qa(e.length,t)}},validate:function(t,e,n){return e>=1&&e<=12},set:function(t,e,n,r){var a=t.getUTCHours()>=12;return a&&n<12?t.setUTCHours(n+12,0,0,0):a||12!==n?t.setUTCHours(n,0,0,0):t.setUTCHours(0,0,0,0),t},incompatibleTokens:["H","K","k","t","T"]},H:{priority:70,parse:function(t,e,n,r){switch(e){case"H":return _a(Va.hour23h,t);case"Ho":return n.ordinalNumber(t,{unit:"hour"});default:return Qa(e.length,t)}},validate:function(t,e,n){return e>=0&&e<=23},set:function(t,e,n,r){return t.setUTCHours(n,0,0,0),t},incompatibleTokens:["a","b","h","K","k","t","T"]},K:{priority:70,parse:function(t,e,n,r){switch(e){case"K":return _a(Va.hour11h,t);case"Ko":return n.ordinalNumber(t,{unit:"hour"});default:return Qa(e.length,t)}},validate:function(t,e,n){return e>=0&&e<=11},set:function(t,e,n,r){return t.getUTCHours()>=12&&n<12?t.setUTCHours(n+12,0,0,0):t.setUTCHours(n,0,0,0),t},incompatibleTokens:["a","b","h","H","k","t","T"]},k:{priority:70,parse:function(t,e,n,r){switch(e){case"k":return _a(Va.hour24h,t);case"ko":return n.ordinalNumber(t,{unit:"hour"});default:return Qa(e.length,t)}},validate:function(t,e,n){return e>=1&&e<=24},set:function(t,e,n,r){var a=n<=24?n%24:n;return t.setUTCHours(a,0,0,0),t},incompatibleTokens:["a","b","h","H","K","t","T"]},m:{priority:60,parse:function(t,e,n,r){switch(e){case"m":return _a(Va.minute,t);case"mo":return n.ordinalNumber(t,{unit:"minute"});default:return Qa(e.length,t)}},validate:function(t,e,n){return e>=0&&e<=59},set:function(t,e,n,r){return t.setUTCMinutes(n,0,0),t},incompatibleTokens:["t","T"]},s:{priority:50,parse:function(t,e,n,r){switch(e){case"s":return _a(Va.second,t);case"so":return n.ordinalNumber(t,{unit:"second"});default:return Qa(e.length,t)}},validate:function(t,e,n){return e>=0&&e<=59},set:function(t,e,n,r){return t.setUTCSeconds(n,0),t},incompatibleTokens:["t","T"]},S:{priority:30,parse:function(t,e,n,r){return Qa(e.length,t,(function(t){return Math.floor(t*Math.pow(10,3-e.length))}))},set:function(t,e,n,r){return t.setUTCMilliseconds(n),t},incompatibleTokens:["t","T"]},X:{priority:10,parse:function(t,e,n,r){switch(e){case"X":return Ya(Na,t);case"XX":return Ya(Fa,t);case"XXXX":return Ya(Ba,t);case"XXXXX":return Ya(Ga,t);case"XXX":default:return Ya(Ha,t)}},set:function(t,e,n,r){return e.timestampIsSet?t:new Date(t.getTime()-n)},incompatibleTokens:["t","T","x"]},x:{priority:10,parse:function(t,e,n,r){switch(e){case"x":return Ya(Na,t);case"xx":return Ya(Fa,t);case"xxxx":return Ya(Ba,t);case"xxxxx":return Ya(Ga,t);case"xxx":default:return Ya(Ha,t)}},set:function(t,e,n,r){return e.timestampIsSet?t:new Date(t.getTime()-n)},incompatibleTokens:["t","T","X"]},t:{priority:40,parse:function(t,e,n,r){return za(t)},set:function(t,e,n,r){return[new Date(1e3*n),{timestampIsSet:!0}]},incompatibleTokens:"*"},T:{priority:20,parse:function(t,e,n,r){return za(t)},set:function(t,e,n,r){return[new Date(n),{timestampIsSet:!0}]},incompatibleTokens:"*"}},ni=10,ri=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ai=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ii=/^'([^]*?)'?$/,oi=/''/g,si=/\S/,ui=/[a-zA-Z]/;function ci(t,e,n,r){if(arguments.length<3)throw new TypeError("3 arguments required, but only "+arguments.length+" present");var a=String(t),i=String(e),o=r||{},s=o.locale||ha;if(!s.match)throw new RangeError("locale must contain match property");var u=s.options&&s.options.firstWeekContainsDate,c=null==u?1:fa(u),d=null==o.firstWeekContainsDate?c:fa(o.firstWeekContainsDate);if(!(d>=1&&d<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var l=s.options&&s.options.weekStartsOn,h=null==l?0:fa(l),f=null==o.weekStartsOn?h:fa(o.weekStartsOn);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(""===i)return""===a?ga(n):new Date(NaN);var g,p={firstWeekContainsDate:d,weekStartsOn:f,locale:s},v=[{priority:ni,set:di,index:0}],m=i.match(ai).map((function(t){var e=t[0];return"p"===e||"P"===e?(0,ba[e])(t,s.formatLong,p):t})).join("").match(ri),w=[];for(g=0;g<m.length;g++){var b=m[g];!o.useAdditionalWeekYearTokens&&ka(b)&&Ta(b),!o.useAdditionalDayOfYearTokens&&Ca(b)&&Ta(b);var y=b[0],M=ei[y];if(M){var S=M.incompatibleTokens;if(Array.isArray(S)){for(var x=void 0,C=0;C<w.length;C++){var k=w[C].token;if(-1!==S.indexOf(k)||k===y){x=w[C];break}}if(x)throw new RangeError("The format string mustn't contain `".concat(x.fullToken,"` and `").concat(b,"` at the same time"))}else if("*"===M.incompatibleTokens&&w.length)throw new RangeError("The format string mustn't contain `".concat(b,"` and any other token at the same time"));w.push({token:y,fullToken:b});var T=M.parse(a,b,s.match,p);if(!T)return new Date(NaN);v.push({priority:M.priority,set:M.set,validate:M.validate,value:T.value,index:v.length}),a=T.rest}else{if(y.match(ui))throw new RangeError("Format string contains an unescaped latin alphabet character `"+y+"`");if("''"===b?b="'":"'"===y&&(b=b.match(ii)[1].replace(oi,"'")),0!==a.indexOf(b))return new Date(NaN);a=a.slice(b.length)}}if(a.length>0&&si.test(a))return new Date(NaN);var R=v.map((function(t){return t.priority})).sort((function(t,e){return e-t})).filter((function(t,e,n){return n.indexOf(t)===e})).map((function(t){return v.filter((function(e){return e.priority===t})).reverse()})).map((function(t){return t[0]})),W=ga(n);if(isNaN(W))return new Date(NaN);var D=pa(W,Ma(W)),P={};for(g=0;g<R.length;g++){var I=R[g];if(I.validate&&!I.validate(D,I.value,p))return new Date(NaN);var E=I.set(D,P,I.value,p);E[0]?(D=E[0],va(P,E[1])):D=E}return D}function di(t,e){if(e.timestampIsSet)return t;var n=new Date(0);return n.setFullYear(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),n.setHours(t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()),n}function li(t,e){for(var n=t<0?"-":"",r=Math.abs(t).toString();r.length<e;)r="0"+r;return n+r}var hi={y:function(t,e){var n=t.getUTCFullYear(),r=n>0?n:1-n;return li("yy"===e?r%100:r,e.length)},M:function(t,e){var n=t.getUTCMonth();return"M"===e?String(n+1):li(n+1,2)},d:function(t,e){return li(t.getUTCDate(),e.length)},a:function(t,e){var n=t.getUTCHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":case"aaa":return n.toUpperCase();case"aaaaa":return n[0];case"aaaa":default:return"am"===n?"a.m.":"p.m."}},h:function(t,e){return li(t.getUTCHours()%12||12,e.length)},H:function(t,e){return li(t.getUTCHours(),e.length)},m:function(t,e){return li(t.getUTCMinutes(),e.length)},s:function(t,e){return li(t.getUTCSeconds(),e.length)},S:function(t,e){var n=e.length,r=t.getUTCMilliseconds();return li(Math.floor(r*Math.pow(10,n-3)),e.length)}},fi=864e5;var gi="midnight",pi="noon",vi="morning",mi="afternoon",wi="evening",bi="night";function yi(t,e){var n=t>0?"-":"+",r=Math.abs(t),a=Math.floor(r/60),i=r%60;if(0===i)return n+String(a);var o=e||"";return n+String(a)+o+li(i,2)}function Mi(t,e){return t%60==0?(t>0?"-":"+")+li(Math.abs(t)/60,2):Si(t,e)}function Si(t,e){var n=e||"",r=t>0?"-":"+",a=Math.abs(t);return r+li(Math.floor(a/60),2)+n+li(a%60,2)}var xi={G:function(t,e,n){var r=t.getUTCFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(t,e,n){if("yo"===e){var r=t.getUTCFullYear(),a=r>0?r:1-r;return n.ordinalNumber(a,{unit:"year"})}return hi.y(t,e)},Y:function(t,e,n,r){var a=Wa(t,r),i=a>0?a:1-a;return"YY"===e?li(i%100,2):"Yo"===e?n.ordinalNumber(i,{unit:"year"}):li(i,e.length)},R:function(t,e){return li(Ia(t),e.length)},u:function(t,e){return li(t.getUTCFullYear(),e.length)},Q:function(t,e,n){var r=Math.ceil((t.getUTCMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return li(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(t,e,n){var r=Math.ceil((t.getUTCMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return li(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(t,e,n){var r=t.getUTCMonth();switch(e){case"M":case"MM":return hi.M(t,e);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(t,e,n){var r=t.getUTCMonth();switch(e){case"L":return String(r+1);case"LL":return li(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(t,e,n,r){var a=qa(t,r);return"wo"===e?n.ordinalNumber(a,{unit:"week"}):li(a,e.length)},I:function(t,e,n){var r=Oa(t);return"Io"===e?n.ordinalNumber(r,{unit:"week"}):li(r,e.length)},d:function(t,e,n){return"do"===e?n.ordinalNumber(t.getUTCDate(),{unit:"date"}):hi.d(t,e)},D:function(t,e,n){var r=function(t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var e=ga(t),n=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var r=n-e.getTime();return Math.floor(r/fi)+1}(t);return"Do"===e?n.ordinalNumber(r,{unit:"dayOfYear"}):li(r,e.length)},E:function(t,e,n){var r=t.getUTCDay();switch(e){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(t,e,n,r){var a=t.getUTCDay(),i=(a-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return li(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(a,{width:"short",context:"formatting"});case"eeee":default:return n.day(a,{width:"wide",context:"formatting"})}},c:function(t,e,n,r){var a=t.getUTCDay(),i=(a-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return li(i,e.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(a,{width:"narrow",context:"standalone"});case"cccccc":return n.day(a,{width:"short",context:"standalone"});case"cccc":default:return n.day(a,{width:"wide",context:"standalone"})}},i:function(t,e,n){var r=t.getUTCDay(),a=0===r?7:r;switch(e){case"i":return String(a);case"ii":return li(a,e.length);case"io":return n.ordinalNumber(a,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(t,e,n){var r=t.getUTCHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(t,e,n){var r,a=t.getUTCHours();switch(r=12===a?pi:0===a?gi:a/12>=1?"pm":"am",e){case"b":case"bb":case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(t,e,n){var r,a=t.getUTCHours();switch(r=a>=17?wi:a>=12?mi:a>=4?vi:bi,e){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(t,e,n){if("ho"===e){var r=t.getUTCHours()%12;return 0===r&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return hi.h(t,e)},H:function(t,e,n){return"Ho"===e?n.ordinalNumber(t.getUTCHours(),{unit:"hour"}):hi.H(t,e)},K:function(t,e,n){var r=t.getUTCHours()%12;return"Ko"===e?n.ordinalNumber(r,{unit:"hour"}):li(r,e.length)},k:function(t,e,n){var r=t.getUTCHours();return 0===r&&(r=24),"ko"===e?n.ordinalNumber(r,{unit:"hour"}):li(r,e.length)},m:function(t,e,n){return"mo"===e?n.ordinalNumber(t.getUTCMinutes(),{unit:"minute"}):hi.m(t,e)},s:function(t,e,n){return"so"===e?n.ordinalNumber(t.getUTCSeconds(),{unit:"second"}):hi.s(t,e)},S:function(t,e){return hi.S(t,e)},X:function(t,e,n,r){var a=(r._originalDate||t).getTimezoneOffset();if(0===a)return"Z";switch(e){case"X":return Mi(a);case"XXXX":case"XX":return Si(a);case"XXXXX":case"XXX":default:return Si(a,":")}},x:function(t,e,n,r){var a=(r._originalDate||t).getTimezoneOffset();switch(e){case"x":return Mi(a);case"xxxx":case"xx":return Si(a);case"xxxxx":case"xxx":default:return Si(a,":")}},O:function(t,e,n,r){var a=(r._originalDate||t).getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+yi(a,":");case"OOOO":default:return"GMT"+Si(a,":")}},z:function(t,e,n,r){var a=(r._originalDate||t).getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+yi(a,":");case"zzzz":default:return"GMT"+Si(a,":")}},t:function(t,e,n,r){var a=r._originalDate||t;return li(Math.floor(a.getTime()/1e3),e.length)},T:function(t,e,n,r){return li((r._originalDate||t).getTime(),e.length)}},Ci=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ki=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ti=/^'([^]*?)'?$/,Ri=/''/g,Wi=/[a-zA-Z]/;function Di(t,e,n){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var r=String(e),a=n||{},i=a.locale||ha,o=i.options&&i.options.firstWeekContainsDate,s=null==o?1:fa(o),u=null==a.firstWeekContainsDate?s:fa(a.firstWeekContainsDate);if(!(u>=1&&u<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var c=i.options&&i.options.weekStartsOn,d=null==c?0:fa(c),l=null==a.weekStartsOn?d:fa(a.weekStartsOn);if(!(l>=0&&l<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!i.localize)throw new RangeError("locale must contain localize property");if(!i.formatLong)throw new RangeError("locale must contain formatLong property");var h=ga(t);if(!function(t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var e=ga(t);return!isNaN(e)}(h))throw new RangeError("Invalid time value");var f=pa(h,Ma(h)),g={firstWeekContainsDate:u,weekStartsOn:l,locale:i,_originalDate:h};return r.match(ki).map((function(t){var e=t[0];return"p"===e||"P"===e?(0,ba[e])(t,i.formatLong,g):t})).join("").match(Ci).map((function(t){if("''"===t)return"'";var e=t[0];if("'"===e)return t.match(Ti)[1].replace(Ri,"'");var n=xi[e];if(n)return!a.useAdditionalWeekYearTokens&&ka(t)&&Ta(t),!a.useAdditionalDayOfYearTokens&&Ca(t)&&Ta(t),n(f,t,i.localize,g);if(e.match(Wi))throw new RangeError("Format string contains an unescaped latin alphabet character `"+e+"`");return t})).join("")}var Pi=function(t){if(t)return t.replace("^",", ").replace(/\^/g," ").trim()},Ii=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MMM D, YYYY";if(t)try{return Di(ci(t,"yyyyMMdd",new Date),e)}catch(t){}},Ei=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"HH:mm:ss";if(t){try{return Di(ci(t.toString().substring(0,"HHmmss.SSS".length),"HHmmss.SSS",new Date(0)),e)}catch(t){}return Di(parsedDateTime,e)}},Oi=(n(50),Pi),ji=Ii,qi=Ei,Ai=function(t){function e(){return g()(this,e),w()(this,y()(e).apply(this,arguments))}return C()(e,t),v()(e,[{key:"render",value:function(){var t=this.props,e=t.studyDate,n=t.studyTime,r=t.studyDescription,a=t.patientName,i=t.patientId,o=t.seriesNumber,s=t.seriesDescription,u=t.voi,c=t.rotation,d=u.windowWidth,l=u.windowCenter,h="W: ".concat(d.toFixed(0)," L: ").concat(l.toFixed(0)),f=c?": ".concat(c.theta.toFixed(1)," : ").concat(c.phi.toFixed(1)):null;return W.a.createElement("div",{className:"ViewportOverlay"},W.a.createElement("div",{className:"top-left overlay-element"},W.a.createElement("div",null,Oi(a)),W.a.createElement("div",null,i)),W.a.createElement("div",{className:"top-right overlay-element"},W.a.createElement("div",null,r),W.a.createElement("div",null,ji(e)," ",qi(n))),W.a.createElement("div",{className:"bottom-right overlay-element"},W.a.createElement("div",null,h),W.a.createElement("div",null,f)),W.a.createElement("div",{className:"bottom-left overlay-element"},W.a.createElement("div",null,o>=0?"Ser: ".concat(o):""),W.a.createElement("div",null,W.a.createElement("div",null,s))))}}]),e}(R.PureComponent);T()(Ai,"propTypes",{voi:P.a.object.isRequired,rotation:P.a.object,studyDate:P.a.string,studyTime:P.a.string,studyDescription:P.a.string,patientName:P.a.string,patientId:P.a.string,seriesNumber:P.a.string,seriesDescription:P.a.string}),T()(Ai,"defaultProps",{voi:{windowWidth:0,windowCenter:0}});var Li=Ai,Ui=n(21);function Vi(t){var e=t,n=function(){e&&(e.unsubscribe(),e=null)};return{sub:function(t){n(),e=t},unsubscribe:n}}var Ni=n(22),Fi=n.n(Ni),Bi=n(23),Hi=n.n(Bi),Gi=n(32),_i=n.n(Gi),Yi=n(33),zi=n.n(Yi),Qi=n(34),Xi=n.n(Qi),Ki=n(35),Zi=n.n(Ki),Ji=function(t,e,n){if(e)for(var r=Math.min(256,e.length),a=0;a<r;a++){var i=e[a];t.cfun.addRGBPoint(a,i[0]/255,i[1]/255,i[2]/255);var o=i[3]/255*n;t.ofun.addPointLong(a,o,.5,1)}};function $i(t,e,n){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=n.colorLUT,o=n.globalOpacity,s=n.visible,u=n.renderOutline,c=n.outlineThickness;if(void 0===s&&(s=!1),void 0===o&&(o=1),void 0===c&&(c=3),e)r=e;else{(r=Fi.a.newInstance(t.get("spacing","origin","direction"))).setDimensions(t.getDimensions()),r.computeTransforms();var d=new Uint8Array(t.getNumberOfPoints()),l=Hi.a.newInstance({numberOfComponents:1,values:d});r.getPointData().setScalars(l)}var h=zi.a.newInstance();if(a){var f=.7*Math.sqrt(r.getSpacing().map((function(t){return t*t})).reduce((function(t,e){return t+e}),0));h.setSampleDistance(f)}var g={actor:_i.a.newInstance(),mapper:h,cfun:Xi.a.newInstance(),ofun:Zi.a.newInstance()};return g.actor.setMapper(g.mapper),g.actor.setVisibility(s),g.ofun.addPointLong(0,0,.5,1),g.ofun.addPointLong(1,1,.5,1),i?Ji(g,i,o):(g.cfun.addRGBPoint(1,1,0,0),g.cfun.addRGBPoint(2,0,1,0),g.cfun.addRGBPoint(3,0,1,1),g.ofun.addPointLong(1,.5,.5,1)),g.actor.getProperty().setRGBTransferFunction(0,g.cfun),g.actor.getProperty().setScalarOpacity(0,g.ofun),g.actor.getProperty().setInterpolationTypeToNearest(),u&&(g.actor.getProperty().setUseLabelOutline(!0),g.actor.getProperty().setLabelOutlineThickness(c)),g.ofun.setClamping(!1),g.actor.getProperty().setScalarOpacityUnitDistance(0,.1),g.actor.getProperty().setUseGradientOpacity(0,!1),g}var to=E.a.importInternal("util/throttle"),eo=360/(2*Math.PI),no=function(t){function e(t){var n;return g()(this,e),n=w()(this,y()(e).call(this,t)),T()(S()(n),"getVOI",(function(t){var e=t.getProperty().getRGBTransferFunction(0).getMappingRange(),n=Math.abs(e[1]-e[0]);return{windowCenter:e[0]+n/2,windowWidth:n}})),n.genericRenderWindow=null,n.widgetManager=U.a.newInstance(),n.container=W.a.createRef(),n.subs={interactor:Vi(),data:Vi(),labelmap:Vi(),paint:Vi(),paintStart:Vi(),paintEnd:Vi()},n.interactorStyleSubs=[],n.state={voi:n.getVOI(t.volumes[0]),rotation:{theta:0,phi:0}},n.apiProperties={},n}return C()(e,t),v()(e,[{key:"updatePaintbrush",value:function(){var t=this.paintWidget.getManipulator(),e=this.paintWidget.getWidgetState().getHandle(),n=this.paintRenderer.getActiveCamera(),r=n.getDirectionOfProjection();t.setNormal.apply(t,h()(r)),t.setOrigin.apply(t,h()(n.getFocalPoint())),e.rotateFromDirections(e.getDirection(),r)}},{key:"componentDidMount",value:function(){var t=this,e=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}));this.genericRenderWindow=j.a.newInstance({background:[0,0,0]}),this.genericRenderWindow.setContainer(this.container.current);var n,r,a=[],i=[];this.renderer=this.genericRenderWindow.getRenderer(),this.renderWindow=this.genericRenderWindow.getRenderWindow();var o=this.genericRenderWindow.getOpenGLRenderWindow();this.paintRenderer=A.a.newInstance(),this.renderWindow.addRenderer(this.paintRenderer),this.renderWindow.setNumberOfLayers(2),this.paintRenderer.setLayer(1),this.paintRenderer.setInteractive(!1),o.buildPass(!0);var s=Qr.newInstance();this.renderWindow.getInteractor().setInteractorStyle(s);var u=function(){var e=t.renderer.getActiveCamera(),n=t.paintRenderer.getActiveCamera(),r=e.getReferenceByName("position"),a=e.getReferenceByName("focalPoint"),i=e.getReferenceByName("viewUp"),o=e.getReferenceByName("viewAngle");n.set({position:r,focalPoint:a,viewUp:i,viewAngle:o})};if(this.renderWindow.getInteractor().onAnimation(u),u(),this.widgetManager.disablePicking(),this.widgetManager.setRenderer(this.paintRenderer),this.paintWidget=Jr.a.newInstance(),this.paintWidget.setRadius(5),this.paintFilter=Kr.a.newInstance(),this.paintFilter.setLabel(1),this.paintFilter.setRadius(5),this.componentDidUpdate({}),this.labelmap&&this.labelmap.actor&&this.renderer.addVolume(this.labelmap.actor),this.props.actors&&(a=a.concat(this.props.actors)),this.labelmap&&this.labelmap.actor&&(a=a.concat(this.labelmap.actor)),this.props.volumes&&(i=i.concat(this.props.volumes)),r=[this.paintFilter],n=[this.paintWidget],this.throttledUpdateRotationOverlay=to(this.updateRotationOverlay,16,{trailing:!0}),this.props.orientation){var c=this.props.orientation;this.setOrientation(c.sliceNormal,c.viewUp)}else s.setSliceNormal(0,0,1);this.renderer.getActiveCamera().setParallelProjection(!0),this.renderer.resetCamera(),s.setVolumeActor(this.props.volumes[0]);var d=s.getSliceRange();s.setSlice((d[0]+d[1])/2),s.onModified((function(){t.updatePaintbrush()})),this.updatePaintbrush();var l=aa.newInstance();l.setRenderer(this.renderer),l.setScale(1),this.svgWidgetManager=l,this.genericRenderWindow.resize();var h=this.updateVOI.bind(this),f=this.getOrientation.bind(this),g=this.setOrientation.bind(this),p=this.resetOrientation.bind(this),v=this.getViewUp.bind(this),m=this.getSliceNormal.bind(this),w=this.setInteractorStyle.bind(this),b=this.getSlabThickness.bind(this),y=this.setSlabThickness.bind(this),M=this.addSVGWidget.bind(this),S=this.getApiProperty.bind(this),x=this.setApiProperty.bind(this),C=this.setSegmentRGB.bind(this),k=this.setSegmentRGBA.bind(this),T=this.setSegmentAlpha.bind(this),R=this.updateImage.bind(this),W=this.setSegmentVisibility.bind(this),D=this.setGlobalOpacity.bind(this),P=this.setVisibility.bind(this),I=this.setOutlineThickness.bind(this),E=this.setOutlineRendering.bind(this),O=this.requestNewSegmentation.bind(this);if(this.svgWidgets={},this.props.onCreated){var q={uid:e,genericRenderWindow:this.genericRenderWindow,widgetManager:this.widgetManager,svgWidgetManager:this.svgWidgetManager,addSVGWidget:M,container:this.container.current,widgets:n,svgWidgets:this.svgWidgets,filters:r,actors:a,volumes:i,_component:this,updateImage:R,updateVOI:h,getOrientation:f,setOrientation:g,resetOrientation:p,getViewUp:v,getSliceNormal:m,setInteractorStyle:w,getSlabThickness:b,setSlabThickness:y,setSegmentRGB:C,setSegmentRGBA:k,setSegmentAlpha:T,setSegmentVisibility:W,setGlobalOpacity:D,setVisibility:P,setOutlineThickness:I,setOutlineRendering:E,requestNewSegmentation:O,get:S,set:x,type:"VIEW2D"};this.props.onCreated(q)}}},{key:"getViewUp",value:function(){return this.genericRenderWindow.getRenderWindow().getInteractor().getInteractorStyle().getViewUp()}},{key:"getSliceNormal",value:function(){return this.genericRenderWindow.getRenderWindow().getInteractor().getInteractorStyle().getSliceNormal()}},{key:"setOrientation",value:function(t,e){var n=this.genericRenderWindow.getRenderWindow().getInteractor().getInteractorStyle();this.updateRotationRelativeToOrientation(t),n.setSliceOrientation(t,e)}},{key:"resetOrientation",value:function(){var t=this.props.orientation||{sliceNormal:[0,0,1],viewUp:[0,-1,0]};this.setOrientation(t.sliceNormal,t.viewUp);var e=this.genericRenderWindow.getRenderWindow().getInteractor().getInteractorStyle(),n=e.getSliceRange();e.setSlice((n[0]+n[1])/2)}},{key:"getApiProperty",value:function(t){return this.apiProperties[t]}},{key:"setApiProperty",value:function(t,e){this.apiProperties[t]=e}},{key:"addSVGWidget",value:function(t,e){var n=this.svgWidgetManager;n.addWidget(t),n.render(),this.svgWidgets[e]=t}},{key:"getSlabThickness",value:function(){var t=this.genericRenderWindow.getRenderWindow().getInteractor().getInteractorStyle();if(t.getSlabThickness)return t.getSlabThickness()}},{key:"setSlabThickness",value:function(t){var e=this.genericRenderWindow.getRenderWindow(),n=e.getInteractor().getInteractorStyle();if(n.setSlabThickness&&(n.setSlabThickness(t),this.props.paintFilterLabelMapImageData)){var r=this.labelmap.actor;!function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-5;return Math.abs(t-e)<n}(t,.1)?r.setVisibility(!1):r.getVisibility()!==this.props.labelmapRenderingOptions.visible&&r.setVisibility(this.props.labelmapRenderingOptions.visible)}e.render()}},{key:"updateImage",value:function(){this.genericRenderWindow.getRenderWindow().render()}},{key:"setInteractorStyle",value:function(t){for(var e,n=this,r=t.istyle,a=t.callbacks,i=void 0===a?{}:a,o=t.configuration,s=void 0===o?{}:o,u=this.props.volumes,c=this.genericRenderWindow.getRenderWindow(),d=c.getInteractor().getInteractorStyle();this.interactorStyleSubs.length;)this.interactorStyleSubs.pop().unsubscribe();d.getViewport&&r.getViewport&&(e=d.getViewport());var l=this.getSlabThickness(),h=c.getInteractor();h.setInteractorStyle(r),r.setInteractor(h),e&&r.setViewport(e),r.getVolumeActor()!==u[0]&&(l&&r.setSlabThickness&&r.setSlabThickness(l),r.setVolumeActor(u[0])),Object.keys(i).forEach((function(t){if("function"==typeof r[t]){var e=r[t](i[t]);e&&"function"==typeof e.unsubscribe&&n.interactorStyleSubs.push(e)}})),s&&r.set(s),c.render()}},{key:"updateVOI",value:function(t,e){this.setState({voi:{windowWidth:t,windowCenter:e}})}},{key:"updateRotationOverlay",value:function(t,e){this.setState({rotation:{theta:t,phi:e}})}},{key:"updateRotationRelativeToOrientation",value:function(t){var e=this.props.orientation.sliceNormal,n=[Math.acos(e[2]),Math.atan2(e[1],e[0])],r=n[0],a=n[1],i=[Math.acos(t[2]),Math.atan2(t[1],t[0])],o=i[0],s=i[1],u=(o*=eo)-(r*=eo),c=(s*=eo)-(a*=eo);u>180?u-=180:u<0&&(u=180-Math.abs(u)),c>=360?c-=360:c<0&&(c=360-Math.abs(c)),this.throttledUpdateRotationOverlay(u,c)}},{key:"getOrientation",value:function(){return this.props.orientation}},{key:"setSegmentRGBA",value:function(t,e){var n=d()(e,4),r=n[0],a=n[1],i=n[2],o=n[3];this.setSegmentRGB(t,[r,a,i]),this.setSegmentAlpha(t,o)}},{key:"setGlobalOpacity",value:function(t){var e=this.labelmap,n=this.props.labelmapRenderingOptions.colorLUT;Ji(e,n,t)}},{key:"setVisibility",value:function(t){this.labelmap.actor.setVisibility(t)}},{key:"setOutlineThickness",value:function(t){this.labelmap.actor.getProperty().setLabelOutlineThickness(t)}},{key:"setOutlineRendering",value:function(t){this.labelmap.actor.getProperty().setUseLabelOutline(t)}},{key:"requestNewSegmentation",value:function(){this.props.labelmapRenderingOptions.onNewSegmentationRequested()}},{key:"setSegmentRGB",value:function(t,e){var n=d()(e,3),r=n[0],a=n[1],i=n[2];this.labelmap.cfun.addRGBPoint(t,r/255,a/255,i/255)}},{key:"setSegmentVisibility",value:function(t,e){this.setSegmentAlpha(t,e?255:0)}},{key:"setSegmentAlpha",value:function(t,e){var n=this.labelmap,r=this.props.labelmapRenderingOptions.globalOpacity;void 0===r&&(r=1);var a=e/255*r;n.ofun.addPointLong(t,a,.5,1)}},{key:"componentDidUpdate",value:function(t){var e=this;if(t.volumes!==this.props.volumes&&(this.props.volumes.forEach((function(t){t.isA("vtkVolume")||console.warn("Data to <Vtk2D> is not vtkVolume data")})),this.props.volumes.length&&this.props.volumes.forEach(this.renderer.addVolume),this.renderWindow.render()),!t.paintFilterBackgroundImageData&&this.props.paintFilterBackgroundImageData?(this.subs.data.sub(this.props.paintFilterBackgroundImageData.onModified((function(){e.genericRenderWindow.resize(),e.renderWindow.render()}))),this.paintFilter.setBackgroundImage(this.props.paintFilterBackgroundImageData)):t.paintFilterBackgroundImageData&&!this.props.paintFilterBackgroundImageData&&(this.paintFilter.setBackgroundImage(null),this.subs.data.unsubscribe()),t.paintFilterLabelMapImageData!==this.props.paintFilterLabelMapImageData&&this.props.paintFilterLabelMapImageData){if(this.subs.labelmap.unsubscribe(),this.labelmap&&this.labelmap.actor&&(this.renderer.removeVolume(this.labelmap.actor),this.api)){var n=this.api.actors,r=n.findIndex((function(t){return t===e.labelmap.actor}));-1!==r&&n.splice(r,1)}var a=this.props.paintFilterLabelMapImageData,i=$i(this.props.paintFilterBackgroundImageData,a,this.props.labelmapRenderingOptions);this.labelmap=i,this.props.labelmapRenderingOptions.segmentsDefaultProperties.forEach((function(t,n){t&&e.setSegmentVisibility(n,t.visible)})),this.labelmap&&this.labelmap.actor&&(this.renderer.addVolume(this.labelmap.actor),this.api&&(this.api.actors=this.api.actors.concat(this.labelmap.actor))),i.mapper.setInputConnection(this.paintFilter.getOutputPort()),this.paintFilter.setLabelMap(a),this.subs.labelmap.sub(a.onModified((function(){i.mapper.modified(),e.renderWindow.render()}))),this.genericRenderWindow.resize()}t.labelmapRenderingOptions&&t.labelmapRenderingOptions.visible!==this.props.labelmapRenderingOptions.visible&&this.labelmap.actor.setVisibility(t.labelmapRenderingOptions.visible),t.painting!==this.props.painting&&(this.props.painting?(this.viewWidget=this.widgetManager.addWidget(this.paintWidget,Ui.ViewTypes.SLICE),this.subs.paintStart.sub(this.viewWidget.onStartInteractionEvent((function(){e.paintFilter.startStroke(),e.paintFilter.addPoint(e.paintWidget.getWidgetState().getTrueOrigin()),e.props.onPaintStart&&e.props.onPaintStart()}))),this.subs.paint.sub(this.viewWidget.onInteractionEvent((function(){e.viewWidget.getPainting()&&(e.paintFilter.addPoint(e.paintWidget.getWidgetState().getTrueOrigin()),e.props.onPaint&&e.props.onPaint())}))),this.subs.paintEnd.sub(this.viewWidget.onEndInteractionEvent((function(){var t=e.paintFilter.endStroke();e.props.onPaintEnd&&t.then((function(t){e.props.onPaintEnd(t)}))}))),this.widgetManager.grabFocus(this.paintWidget),this.widgetManager.enablePicking(),this.genericRenderWindow.resize()):this.viewWidget&&(this.widgetManager.releaseFocus(),this.widgetManager.removeWidget(this.paintWidget),this.widgetManager.disablePicking(),this.subs.paintStart.unsubscribe(),this.subs.paint.unsubscribe(),this.subs.paintEnd.unsubscribe(),this.viewWidget=null,this.genericRenderWindow.resize()))}},{key:"componentWillUnmount",value:function(){var t=this;Object.keys(this.subs).forEach((function(e){t.subs[e].unsubscribe()})),this.props.onDestroyed&&this.props.onDestroyed(),this.genericRenderWindow.delete()}},{key:"render",value:function(){if(!this.props.volumes||!this.props.volumes.length)return null;var t={width:"100%",height:"100%",position:"relative"},e=this.state.voi,n=this.props.showRotation?this.state.rotation:null;return W.a.createElement("div",{style:t},W.a.createElement("div",{ref:this.container,style:t}),W.a.createElement(Li,u()({},this.props.dataDetails,{voi:e,rotation:n})))}}]),e}(R.Component);T()(no,"propTypes",{volumes:P.a.array.isRequired,actors:P.a.array,painting:P.a.bool.isRequired,paintFilterBackgroundImageData:P.a.object,paintFilterLabelMapImageData:P.a.object,onPaint:P.a.func,onPaintStart:P.a.func,onPaintEnd:P.a.func,dataDetails:P.a.object,onCreated:P.a.func,onDestroyed:P.a.func,orientation:P.a.object,labelmapRenderingOptions:P.a.object,showRotation:P.a.bool}),T()(no,"defaultProps",{painting:!1,labelmapRenderingOptions:{visible:!0,renderOutline:!0,segmentsDefaultProperties:[],onNewSegmentationRequested:function(){}},showRotation:!1});var ro=function(t){function e(t){var n;return g()(this,e),(n=w()(this,y()(e).call(this,t))).genericRenderWindow=null,n.widgetManager=U.a.newInstance(),n.container=W.a.createRef(),n.subs={interactor:Vi(),data:Vi(),labelmap:Vi(),paint:Vi(),paintStart:Vi(),paintEnd:Vi()},n}return C()(e,t),v()(e,[{key:"componentDidMount",value:function(){this.genericRenderWindow=j.a.newInstance({background:[0,0,0]}),this.genericRenderWindow.setContainer(this.container.current);var t,e,n=[],r=[];if(this.renderer=this.genericRenderWindow.getRenderer(),this.renderWindow=this.genericRenderWindow.getRenderWindow(),this.widgetManager.disablePicking(),this.widgetManager.setRenderer(this.renderer),this.paintWidget=Jr.a.newInstance(),this.paintWidget.setRadius(5),this.paintFilter=Kr.a.newInstance(),this.paintFilter.setLabel(1),this.paintFilter.setRadius(5),this.componentDidUpdate({}),this.props.actors&&(n=n.concat(this.props.actors)),this.labelmap&&this.labelmap.actor&&(n=n.concat(this.labelmap.actor)),this.props.volumes&&(r=r.concat(this.props.volumes)),e=[this.paintFilter],t=[this.paintWidget],this.labelmap&&this.labelmap.actor&&this.renderer.addVolume(this.labelmap.actor),this.renderer.resetCamera(),this.renderer.updateLightsGeometryToFollowCamera(),this.genericRenderWindow.resize(),this.props.onCreated){var a={genericRenderWindow:this.genericRenderWindow,widgetManager:this.widgetManager,container:this.container.current,widgets:t,filters:e,actors:n,volumes:r,type:"VIEW3D",_component:this};this.props.onCreated(a)}}},{key:"componentDidUpdate",value:function(t){var e=this;if(console.time("View3D componentDidUpdate"),t.volumes!==this.props.volumes&&(this.props.volumes.forEach((function(t){t.isA("vtkVolume")||console.warn("Data to <Vtk2D> is not vtkVolume data")})),this.props.volumes.length&&this.props.volumes.forEach(this.renderer.addVolume),this.renderWindow.render()),t.actors!==this.props.actors&&this.props.actors&&(this.props.actors.forEach((function(t){t.isA("vtkActor")||console.warn("Data to <Vtk2D> is not vtkActor data")})),this.props.actors.length&&this.props.actors.forEach(this.renderer.addActor),this.renderWindow.render()),!t.paintFilterBackgroundImageData&&this.props.paintFilterBackgroundImageData?(this.subs.data.sub(this.props.paintFilterBackgroundImageData.onModified((function(){return e.renderWindow.render()}))),this.paintFilter.setBackgroundImage(this.props.paintFilterBackgroundImageData)):t.paintFilterBackgroundImageData&&!this.props.paintFilterBackgroundImageData&&(this.paintFilter.setBackgroundImage(null),this.subs.data.unsubscribe()),t.paintFilterLabelMapImageData!==this.props.paintFilterLabelMapImageData&&this.props.paintFilterLabelMapImageData){this.subs.labelmap.unsubscribe();var n=this.props.paintFilterLabelMapImageData,r=$i(this.props.paintFilterBackgroundImageData,n,this.props.labelmapRenderingOptions,!1);this.labelmap=r,r.mapper.setInputConnection(this.paintFilter.getOutputPort()),this.paintFilter.setLabelMap(n),this.subs.labelmap.sub(n.onModified((function(){r.mapper.modified(),e.renderWindow.render()})))}t.painting!==this.props.painting&&(this.props.painting?(console.time("turnOnPainting"),this.viewWidget=this.widgetManager.addWidget(this.paintWidget,Ui.ViewTypes.VOLUME),this.subs.paintStart.sub(this.viewWidget.onStartInteractionEvent((function(){e.paintFilter.startStroke(),e.paintFilter.addPoint(e.paintWidget.getWidgetState().getTrueOrigin()),e.props.onPaintStart&&e.props.onPaintStart()}))),this.subs.paint.sub(this.viewWidget.onInteractionEvent((function(){e.viewWidget.getPainting()&&(e.paintFilter.addPoint(e.paintWidget.getWidgetState().getTrueOrigin()),e.props.onPaint&&e.props.onPaint())}))),this.subs.paintEnd.sub(this.viewWidget.onEndInteractionEvent((function(){var t=e.paintFilter.endStroke();e.props.onPaintEnd&&t.then((function(t){e.props.onPaintEnd(t)}))}))),this.widgetManager.grabFocus(this.paintWidget),this.widgetManager.enablePicking(),console.timeEnd("turnOnPainting")):this.viewWidget&&(console.time("turnOffPainting"),this.widgetManager.releaseFocus(),this.widgetManager.removeWidget(this.paintWidget),this.widgetManager.disablePicking(),this.subs.paintStart.unsubscribe(),this.subs.paint.unsubscribe(),this.subs.paintEnd.unsubscribe(),this.viewWidget=null,console.timeEnd("turnOffPainting"))),console.timeEnd("View3D componentDidUpdate")}},{key:"componentWillUnmount",value:function(){var t=this;Object.keys(this.subs).forEach((function(e){t.subs[e].unsubscribe()})),this.props.onDestroyed&&this.props.onDestroyed(),this.genericRenderWindow.delete()}},{key:"render",value:function(){if(!this.props.volumes&&!this.props.actors)return null;var t={width:"100%",height:"100%",position:"relative"},e={windowCenter:0,windowWidth:0};if(this.pipeline){var n=this.props.volumes[0].getProperty().getRGBTransferFunction(0).getMappingRange(),r=n[0]+n[1];e={windowCenter:n[0]+r/2,windowWidth:r}}return W.a.createElement("div",{style:t},W.a.createElement("div",{ref:this.container,style:t}),W.a.createElement(Li,u()({},this.props.dataDetails,{voi:e})))}}]),e}(R.Component);function ao(t,e){var n=Math.abs(t-e);return{windowWidth:n,windowCenter:t+n/2}}T()(ro,"propTypes",{volumes:P.a.array,actors:P.a.array,painting:P.a.bool.isRequired,paintFilterBackgroundImageData:P.a.object,paintFilterLabelMapImageData:P.a.object,onPaint:P.a.func,onPaintStart:P.a.func,onPaintEnd:P.a.func,sliceNormal:P.a.array.isRequired,dataDetails:P.a.object,onCreated:P.a.func,onDestroyed:P.a.func,labelmapRenderingOptions:P.a.object}),T()(ro,"defaultProps",{painting:!1,sliceNormal:[0,0,1],labelmapRenderingOptions:{visible:!0,renderOutline:!1}});var io=at.a.States;var oo={wlStartPos:[0,0],levelScale:1};function so(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,oo,n),Qr.extend(t,e,n),N.a.setGet(t,e,["onLevelsChanged","levelScale"]),function(t,e){e.classHierarchy.push("vtkInteractorStyleMPRWindowLevel");var n=t.handleMouseMove;t.handleMouseMove=function(r){var a=[r.position.x,r.position.y];e.state===io.IS_WINDOW_LEVEL&&(t.windowLevelFromMouse(a),t.invokeInteractionEvent({type:"InteractionEvent"})),n&&n(r)},t.windowLevelFromMouse=function(n){var r=e.volumeActor.getMapper().getInputData().getPointData().getScalars().getRange(),a=r[1]-r[0],i=Math.round(a/1024)*t.getLevelScale(),o=Math.round((n[0]-e.wlStartPos[0])*i),s=Math.round((n[1]-e.wlStartPos[1])*i),u=e.levels.windowWidth+o,c=e.levels.windowCenter-s;if(u=Math.max(.01,u),e.windowWidth!==u||e.windowCenter!==c){t.setWindowLevel(u,c),e.wlStartPos[0]=Math.round(n[0]),e.wlStartPos[1]=Math.round(n[1]);var d=t.getOnLevelsChanged();d&&d({windowCenter:c,windowWidth:u})}},t.getWindowLevel=function(){var t=e.volumeActor.getProperty().getRGBTransferFunction(0).getMappingRange().slice();return ao.apply(void 0,h()(t))},t.setWindowLevel=function(t,n){var r=function(t,e){return{lower:e-t/2,upper:e+t/2}}(t,n);e.levels.windowWidth=t,e.levels.windowCenter=n,e.volumeActor.getProperty().getRGBTransferFunction(0).setMappingRange(r.lower,r.upper)};var r=t.handleLeftButtonPress;t.handleLeftButtonPress=function(n){if(e.wlStartPos[0]=n.position.x,e.wlStartPos[1]=n.position.y,n.shiftKey||n.controlKey)r&&r(n);else{var a=e.volumeActor.getProperty();a&&(e.initialMRange=a.getRGBTransferFunction(0).getMappingRange().slice(),e.levels=ao(e.initialMRange[0],e.initialMRange[1]),t.startWindowLevel())}},t.superHandleLeftButtonRelease=t.handleLeftButtonRelease,t.handleLeftButtonRelease=function(){switch(e.state){case io.IS_WINDOW_LEVEL:t.endWindowLevel();break;default:t.superHandleLeftButtonRelease()}}}(t,e)}var uo=N.a.newInstance(so,"vtkInteractorStyleMPRWindowLevel"),co=Object.assign({newInstance:uo,extend:so}),lo=at.a.States;var ho={};function fo(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,ho,n),Qr.extend(t,e,n),N.a.setGet(t,e,["callback","apis","apiIndex","onScroll"]),function(t,e){function n(n){var r=e.apis,a=e.apiIndex,i=r[a],o=n.position,s=n.pokedRenderer,u=nt.a.newInstance();u.setCoordinateSystemToDisplay(),u.setValue(o.x,o.y,0);for(var c=u.getComputedWorldValue(s),d=s.getActiveCamera().getDirectionOfProjection(),l=i.getSlabThickness()/2,h=0;h<c.length;h++)c[h]+=l*d[h];i.svgWidgets.crosshairsWidget.moveCrosshairs(c,r,a),t.invokeInteractionEvent({type:"InteractionEvent"})}e.classHierarchy.push("vtkInteractorStyleMPRCrosshairs");var r=t.handleMouseMove;t.handleMouseMove=function(t){e.state===lo.IS_WINDOW_LEVEL&&n(t),r&&r(t)};var a=t.handleLeftButtonPress;t.handleLeftButtonPress=function(r){r.shiftKey||r.controlKey?a&&a(r):e.volumeActor&&(n(r),t.startWindowLevel())},t.superHandleLeftButtonRelease=t.handleLeftButtonRelease,t.handleLeftButtonRelease=function(){switch(e.state){case lo.IS_WINDOW_LEVEL:t.endWindowLevel();break;default:t.superHandleLeftButtonRelease()}}}(t,e)}var go=N.a.newInstance(fo,"vtkInteractorStyleMPRCrosshairs"),po=Object.assign({newInstance:go,extend:fo}),vo=at.a.States,mo={ROTATE_CROSSHAIRS:0,MOVE_CROSSHAIRS:1,MOVE_REFERENCE_LINE:2,PAN:3};function wo(t,e){function n(){var t=e.apis,n=e.apiIndex;t.forEach((function(t,e){if(e!==n){var r=t.svgWidgets.rotatableCrosshairsWidget;if(!r)throw new Error("Must use rotatable crosshair svg widget with this istyle.");var a=r.getReferenceLines();a[0].active=!1,a[1].active=!1}}))}function r(t,e){var n=d()(t.points,2),r=n[0],a=n[1],i=e;return 2*Math.abs((r.x*(a.y-i.y)+a.x*(i.y-r.y)+i.x*(r.y-a.y))/2)/o.distance([r.x,r.y],[a.x,a.y])}function a(t){var n,r=e.operation;switch(r.type){case mo.MOVE_CROSSHAIRS:s(t.position,t.pokedRenderer);break;case mo.MOVE_REFERENCE_LINE:n=r.snapToLineIndex,s(function(t,n){var r=e.apis,a=e.apiIndex,i=r[a],s=i.svgWidgetManager,u=s.getSize(),c=s.getScale(),d=u[1],l={x:t.x*c,y:d-t.y*c},h=i.svgWidgets.rotatableCrosshairsWidget.getReferenceLines()[n].points,f=[],g=[];o.sub(f,[l.x,l.y],[h[0].x,h[0].y]),o.sub(g,[h[1].x,h[1].y],[h[0].x,h[0].y]);var p=o.distance([h[0].x,h[0].y],[h[1].x,h[1].y]),v=[g[0]/p,g[1]/p],m=o.dot(f,g)/p,w=[h[0].x+v[0]*m,h[0].y+v[1]*m];return{x:w[0]/c,y:(d-w[1])/c}}(t.position,n),t.pokedRenderer);break;case mo.ROTATE_CROSSHAIRS:!function(t){var n=e.operation,r=n.prevPosition,a=t.position;if(a.x===r.x&&a.y===r.y)return;var s=e.apis,u=e.apiIndex,c=s[u],d=c.svgWidgets.rotatableCrosshairsWidget.getPoint(),l=[],h=[];o.subtract(l,[r.x,r.y],d),o.subtract(h,[a.x,a.y],d);var f=o.angle(l,h);h[0]*l[1]-h[1]*l[0]>0&&(f*=-1);var g=c.getSliceNormal(),p=[-g[0],-g[1],-g[2]];s.forEach((function(t,e){if(e!==u){var n=t.genericRenderWindow.getRenderWindow().getInteractor().getCurrentRenderer().getActiveCamera(),r=t.get("cachedCrosshairWorldPosition"),a=t.get("initialCachedCrosshairWorldPosition"),i=[];B.a.subtract(r,a,i);var o=[];B.a.add(r,i,o);var s=G.a.buildFromRadian().translate(o[0],o[1],o[2]).rotate(f,p).translate(-o[0],-o[1],-o[2]).matrix;n.applyTransform(s);var c=t.getSliceNormal(),d=t.getViewUp();t.setOrientation(c,d)}})),i(t),s.forEach((function(t){var e=t.genericRenderWindow.getRenderWindow().getInteractor().getCurrentRenderer().getActiveCamera(),n=t.get("cachedCrosshairWorldPosition"),r=e.getFocalPoint(),a=e.getPosition(),i=[];B.a.subtract(r,a,i);var o=[];B.a.subtract(n,a,o);var s=i[0]*i[0]+i[1]*i[1]+i[2]*i[2];B.a.multiplyScalar(i,B.a.dot(o,i)/s);var u=[];B.a.subtract(o,i,u);var c=[];B.a.subtract(n,u,c),e.setFocalPoint(c[0],c[1],c[2])})),n.prevPosition=a}(t)}}function i(t){var n=e.apis,r=e.apiIndex,a=n[r],i=a.svgWidgets.rotatableCrosshairsWidget,o=a.get("cachedCrosshairWorldPosition");i.moveCrosshairs(o,n,r)}function s(n,r){var a=e.apis,i=e.apiIndex,o=a[i],s=nt.a.newInstance();s.setCoordinateSystemToDisplay(),s.setValue(n.x,n.y,0);for(var u=s.getComputedWorldValue(r),c=r.getActiveCamera().getDirectionOfProjection(),d=o.getSlabThickness()/2,l=0;l<u.length;l++)u[l]+=d*c[l];o.svgWidgets.rotatableCrosshairsWidget.moveCrosshairs(u,a,i),t.invokeInteractionEvent({type:"InteractionEvent"})}function u(t,n){var r=e.apis[e.apiIndex],a=r.svgWidgetManager,i=(r.volumes[0],a.getSize()),u=a.getScale(),c=i[1],d=r.genericRenderWindow.getRenderer(),l=r.svgWidgets.rotatableCrosshairsWidget;if(!l)throw new Error("Must use rotatable crosshair svg widget with this istyle.");var h,f=l.getReferenceLines(),g=0===t?1:0,p=l.getPoint(),v=[p[0]*u,c-p[1]*u],m=f[g].points;h=Math.abs(m[0].y-m[1].y)<1?m[0].x<m[1].x?[m[0],m[1]]:[m[1],m[0]]:m[0].y<m[1].y?[m[0],m[1]]:[m[1],m[0]];var w=[];o.subtract(w,[h[1].x,h[1].y],[h[0].x,h[0].y]),o.normalize(w,w),"forwards"===n&&(w[0]*=-1,w[1]*=-1);var b,y,M,S,x=function(t){var n=e.apis,r=e.apiIndex,a=n[r],i=a.volumes,s=a.genericRenderWindow.getRenderer(),u=i[0].getMapper().getInputData().getSpacing().map((function(t){return t*t})).reduce((function(t,e){return t+e}),0),c=nt.a.newInstance();c.setCoordinateSystemToDisplay(),c.setValue(t[0],t[1],0);var d=c.getComputedWorldValue(s);c.setValue(t[0]+1,t[1],0);var l=c.getComputedWorldValue(s),h=o.distance(d,l);return u/h}(p),C=[v[0]+w[0]*x,v[1]+w[1]*x];h[0].x<h[1].x?(b=h[0].x,y=h[1].x):(b=h[1].x,y=h[0].x),h[0].y<h[1].y?(M=h[0].y,S=h[1].y):(M=h[1].y,S=h[0].y),C[0]=Math.min(Math.max(C[0],b),y),C[1]=Math.min(Math.max(C[1],M),S),s({x:C[0]/u,y:(c-C[1])/u},d)}e.classHierarchy.push("vtkInteractorStyleRotatableMPRCrosshairs");var c=t.handleMouseMove;t.handleMouseMove=function(t){e.state===vo.IS_WINDOW_LEVEL?a(t):function(t){var n,a=e.apis,s=e.apiIndex,u=e.lineGrabDistance,c=a[s],d=t.position,l=[!1,!1],h=[!1,!1],f=c.svgWidgets.rotatableCrosshairsWidget;if(!f)throw new Error("Must use rotatable crosshair svg widget with this istyle.");var g=f.getReferenceLines(),p=f.getPoint(),v=f.getCenterRadius();if(o.distance(p,[d.x,d.y])>v){for(var m=c.svgWidgetManager,w=m.getSize(),b=m.getScale(),y=w[1],M={x:d.x*b,y:y-d.y*b},S=!1,x=0;x<g.length;x++)for(var C=g[x].rotateHandles.points,k=0;k<C.length;k++){if(o.distance([C[k].x,C[k].y],[M.x,M.y])<u){l[x]=!0,S=!0;break}}if(!S){var T=r(g[0],M),R=r(g[1],M);if(T<=u||R<=u)h[T<R?0:1]=!0}}else h[0]=!0,h[1]=!0;g.forEach((function(t,e){var r=h[e],a=l[e],i=t.rotateHandles;t.selected!==r&&(t.selected=r,n=!0),i.selected!==a&&(i.selected=a,n=!0)})),n&&i()}(t),c&&c(t)},t.handleLeftButtonPress=function(i){e.volumeActor&&(!function(t){var a=e.apis,i=e.apiIndex,s=e.lineGrabDistance,u=a[i],c=t.position;n();var d=u.svgWidgets.rotatableCrosshairsWidget;if(!d)throw new Error("Must use rotatable crosshair svg widget with this istyle.");var l=d.getReferenceLines(),h=d.getPoint(),f=d.getCenterRadius();if(o.distance(h,[c.x,c.y])<f)return e.operation={type:mo.MOVE_CROSSHAIRS},void l.forEach((function(t){t.selected=!0}));for(var g=u.svgWidgetManager,p=g.getSize(),v=g.getScale(),m=p[1],w={x:c.x*v,y:m-c.y*v},b=0;b<l.length;b++)for(var y=l[b].rotateHandles,M=y.points,S=0;S<M.length;S++){if(o.distance([M[S].x,M[S].y],[w.x,w.y])<s)return e.operation={type:mo.ROTATE_CROSSHAIRS,prevPosition:c},y.selected=!0,void(0===b?(l[0].active=!0,l[1].active=!1):(l[0].active=!1,l[1].active=!0))}var x=r(l[0],w),C=r(l[1],w);if(x<=s||C<=s){var k=x<C?0:1;return l[k].selected=!0,l[k].active=!0,l[0===k?1:0].active=!1,void(e.operation={type:mo.MOVE_REFERENCE_LINE,snapToLineIndex:0===k?1:0})}l.forEach((function(t){t.active=!1})),n(),e.operation={type:null}}(i),a(i),t.startWindowLevel())},t.superHandleLeftButtonRelease=t.handleLeftButtonRelease,t.handleLeftButtonRelease=function(n){switch(e.state){case vo.IS_WINDOW_LEVEL:!function(n){e.operation={type:null};var r=e.apis,a=e.apiIndex,o=r[a].svgWidgets.rotatableCrosshairsWidget;if(!o)throw new Error("Must use rotatable crosshair svg widget with this istyle.");o.getReferenceLines().forEach((function(t){t.selected=!1,t.rotateHandles.selected=!1})),i(),t.endWindowLevel()}();break;default:t.superHandleLeftButtonRelease()}};var l=t.scrollToSlice;t.scrollToSlice=function(n){var r,a=e.apis,i=e.apiIndex,o=(e.lineGrabDistance,a[i].svgWidgets.rotatableCrosshairsWidget);if(!o)throw new Error("Must use rotatable crosshair svg widget with this istyle.");if(o.getReferenceLines().forEach((function(t,e){t.active&&(r=e)})),void 0===r)e.disableNormalMPRScroll||l(n);else{var s=t.getSlice()-n;u(r,s>0?"forwards":"backwards")}}}var bo={operation:{type:null},lineGrabDistance:20,disableNormalMPRScroll:!1};function yo(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,bo,n),Qr.extend(t,e,n),N.a.setGet(t,e,["callback","apis","apiIndex","onScroll","operation","lineGrabDistance","disableNormalMPRScroll"]),wo(t,e)}var Mo=N.a.newInstance(yo,"vtkInteractorStyleRotatableMPRCrosshairs"),So=Object.assign({newInstance:Mo,extend:yo}),xo=at.a.States;var Co={rotateStartPos:[0,0]};function ko(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,Co,n),Qr.extend(t,e,n),N.a.setGet(t,e,["onInteractiveRotateChanged"]),function(t,e){e.classHierarchy.push("vtkInteractorStyleMPRRotate"),e.wlStartPos=[0,0];var n=t.handleMouseMove;t.handleMouseMove=function(r){var a=[Math.round(r.position.x),Math.round(r.position.y)],i=r.pokedRenderer;e.state===xo.IS_ROTATE&&(t.rotateFromMouse(a,i),t.invokeInteractionEvent({type:"InteractionEvent"})),n&&n(r)},t.rotateFromMouse=function(n,r){var a=e.interactor.getView().getViewportSize(r),i=100/a[0],o=100/a[1],s=-(n[1]-e.rotateStartPos[1])*o,u=-(n[0]-e.rotateStartPos[0])*i;t.getViewport().rotateRelative(s,u),e.rotateStartPos[0]=Math.round(n[0]),e.rotateStartPos[1]=Math.round(n[1]);var c=e.apis,d=e.apiIndex,l=c[d];if(l.svgWidgets.crosshairsWidget||l.svgWidgets.rotatableCrosshairsWidget){var f=l.get("cachedCrosshairWorldPosition");if(void 0!==f){var g=nt.a.newInstance();g.setCoordinateSystemToWorld(),g.setValue.apply(g,h()(f));var p=g.getComputedDoubleDisplayValue(r),v=nt.a.newInstance();v.setCoordinateSystemToDisplay(),v.setValue(p[0],p[1],0);for(var m=v.getComputedWorldValue(r),w=r.getActiveCamera().getDirectionOfProjection(),b=l.getSlabThickness()/2,y=0;y<m.length;y++)m[y]+=b*w[y];l.svgWidgets.crosshairsWidget&&l.svgWidgets.crosshairsWidget.moveCrosshairs(m,c,d),l.svgWidgets.rotatableCrosshairsWidget&&l.svgWidgets.rotatableCrosshairsWidget.moveCrosshairs(m,c,d)}}};var r=t.handleLeftButtonPress;t.handleLeftButtonPress=function(n){(e.rotateStartPos[0]=Math.round(n.position.x),e.rotateStartPos[1]=Math.round(n.position.y),n.shiftKey||n.controlKey)?r&&r(n):e.volumeActor.getProperty()&&t.startRotate()},t.superHandleLeftButtonRelease=t.handleLeftButtonRelease,t.handleLeftButtonRelease=function(){switch(e.state){case xo.IS_ROTATE:t.endRotate();break;default:t.superHandleLeftButtonRelease()}}}(t,e)}var To=N.a.newInstance(ko,"vtkInteractorStyleMPRRotate"),Ro=Object.assign({newInstance:To,extend:ko}),Wo=1;function Do(t,e){e.classHierarchy.push("vtkSVGCrosshairsWidget"),e.widgetId="vtkSVGCrosshairsWidget-".concat(Wo++),t.render=function(t,n){var r=function(t,e){var n=t.querySelector("#".concat(e));return n||((n=document.createElement("g")).setAttribute("id",e),t.appendChild(n)),n}(t,e.widgetId),a=e.point,i=e.strokeColor,o=e.strokeWidth,s=e.strokeDashArray,u=e.padding;if(null!==a[0]&&null!==a[1]){var c=parseInt(t.getAttribute("width"),10),d=parseInt(t.getAttribute("height"),10),l=a.slice();l[0]=a[0]*n,l[1]=d-a[1]*n;var h=[0,d/n/2],f=[c/n/2,0],g=[c/n,d/n/2],p=[c/n/2,d/n];e.display?r.innerHTML='\n      <g id="container" fill-opacity="1" stroke-dasharray="none" stroke="none" stroke-opacity="1" fill="none">\n       <g>\n       \x3c!-- TODO: Why is this <svg> necessary?? </svg> If I don\'t include it, nothing renders !--\x3e\n       <svg version="1.1" viewBox="0 0 '.concat(c," ").concat(d,'" width=').concat(c," height=").concat(d,' style="width: 100%; height: 100%">\n       \x3c!-- Top !--\x3e\n        <line\n          x1="').concat(l[0],'"\n          y1="').concat(f[1],'"\n          x2="').concat(l[0],'"\n          y2="').concat(l[1]-u,'"\n          stroke="').concat(i,'"\n          stroke-dasharray="').concat(s,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width="').concat(o,'"\n        ></line>\n        \x3c!-- Right !--\x3e\n        <line\n          x1="').concat(g[0],'"\n          y1="').concat(l[1],'"\n          x2="').concat(l[0]+u,'"\n          y2="').concat(l[1],'"\n          stroke-dasharray="').concat(s,'"\n          stroke="').concat(i,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width=').concat(o,'\n        ></line>\n        \x3c!-- Bottom !--\x3e\n        <line\n          x1="').concat(l[0],'"\n          y1="').concat(p[1],'"\n          x2="').concat(l[0],'"\n          y2="').concat(l[1]+u,'"\n          stroke-dasharray="').concat(s,'"\n          stroke="').concat(i,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width=').concat(o,'\n        ></line>\n        \x3c!-- Left !--\x3e\n        <line\n          x1="').concat(h[0],'"\n          y1="').concat(l[1],'"\n          x2="').concat(l[0]-u,'"\n          y2="').concat(l[1],'"\n          stroke-dasharray="').concat(s,'"\n          stroke="').concat(i,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width=').concat(o,"\n        ></line>\n       </g>\n      </g>\n            "):r.innerHTML=""}},t.resetCrosshairs=function(e,n){var r=e[n];if(r.svgWidgets.crosshairsWidget){var a=r.genericRenderWindow.getRenderer(),i=a.getRenderWindow().getViews()[0].getViewportSize(a),o=nt.a.newInstance();o.setCoordinateSystemToDisplay(),o.setValue(.5*i[0],.5*i[1],0);for(var s=o.getComputedWorldValue(a),u=a.getActiveCamera().getDirectionOfProjection(),c=r.getSlabThickness()/2,d=0;d<s.length;d++)s[d]+=c*u[d];t.moveCrosshairs(s,e)}},t.moveCrosshairs=function(t,e){void 0!==t&&void 0!==e||console.error("worldPos, apis must be defined in order to update crosshairs."),e.forEach((function(e,n){e.set("cachedCrosshairWorldPosition",t);var r=e.genericRenderWindow.getRenderWindow(),a=r.getInteractor().getInteractorStyle(),i=a.getSliceNormal(),o=G.a.buildFromDegree().identity().rotateFromDirections(i,[1,0,0]),s=t.slice();o.apply(s);var u=s[0];a.setSlice(u),r.render();var c=e.genericRenderWindow.getRenderer(),d=nt.a.newInstance();d.setCoordinateSystemToWorld(),d.setValue.apply(d,h()(t));var l=d.getComputedDisplayValue(c),f=e.svgWidgetManager;e.svgWidgets.crosshairsWidget.setPoint(l[0],l[1]),f.render()}))},t.updateCrosshairForApi=function(e){if(e.svgWidgets.crosshairsWidget){var n=e.genericRenderWindow.getRenderer(),r=e.get("cachedCrosshairWorldPosition"),a=nt.a.newInstance();a.setCoordinateSystemToWorld(),a.setValue.apply(a,h()(r));var i=a.getComputedDoubleDisplayValue(n),o=nt.a.newInstance();o.setCoordinateSystemToDisplay(),o.setValue(i[0],i[1],0);for(var s=o.getComputedWorldValue(n),u=n.getActiveCamera().getDirectionOfProjection(),c=e.getSlabThickness()/2,d=0;d<s.length;d++)s[d]+=c*u[d];t.moveCrosshairs(s,[e])}}}var Po={point:[null,null],strokeColor:"#00ff00",strokeWidth:1,strokeDashArray:"",padding:20,display:!0};function Io(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,Po,n),N.a.obj(t,e),N.a.get(t,e,["widgetId"]),N.a.setGet(t,e,["strokeColor","strokeWidth","strokeDashArray","display"]),N.a.setGetArray(t,e,["point","padding"],2),Do(t,e)}var Eo={newInstance:N.a.newInstance(Io,"vtkSVGCrosshairsWidget"),extend:Io},Oo=1e-6,jo=1;function qo(t,e,n){var r=d()(n,2),a=r[0],i=r[1];if(Math.abs(e)<Oo)return t<0;var o=t/e;if(e>0){if(o>i)return 0;o>a&&(n[0]=o)}else{if(o<a)return 0;o<i&&(n[1]=o)}return 1}var Ao=1;function Lo(t,e){e.classHierarchy.push("vtkSVGRotatableCrosshairsWidget"),e.widgetId="vtkSVGRotatableCrosshairsWidget-".concat(Ao++),e.calculateReferenceLines=function(t,n){var r=e.strokeColors,i=e.apis;if(null!==n[0]&&null!==n[1]){var s=i[t],u=s.svgWidgetManager,c=u.getSize(),l=d()(c,2),h=l[0],f=l[1],g=u.getScale(),p=n.slice();p[0]=n[0]*g,p[1]=f-n[1]*g;for(var v=h/g,m=f/g,w=Math.min(h,f)/4,b=Math.sqrt(m*m+v*v),y=[],M=i[t].get("cachedCrosshairWorldPosition"),S=s.svgWidgets.rotatableCrosshairsWidget,x=S.getReferenceLines(),C=function(e){if(e!==t){var n=i[e],u=n.getViewUp(),c=n.getSliceNormal(),l=[];a.cross(l,u,c),a.normalize(l,l);var h=[M[0]+1e6*(u[0]+l[0]),M[1]+1e6*(u[1]+l[1]),M[2]+1e6*(u[2]+l[2])],S=s.genericRenderWindow.getRenderer(),C=nt.a.newInstance();C.setCoordinateSystemToWorld(),C.setValue.apply(C,h);var k=C.getComputedDoubleDisplayValue(S),T=[k[0]*g,f-k[1]*g],R=[];o.subtract(R,p,T),o.normalize(R,R);var W=[p[0]+R[0]*b,p[1]+R[1]*b],D=[p[0]-R[0]*b,p[1]-R[1]*b];!function(t,e,n,r,a){var i=d()(t,2),o=i[0],s=i[1],u=d()(e,2),c=u[0]-o,l=u[1]-s;if(void 0===r||void 0===a?(r=t,a=e):(r[0]=t[0],r[1]=t[1],a[0]=e[0],a[1]=e[1]),Math.abs(c)<Oo&&Math.abs(l)<Oo&&o>=n[0]&&o<=n[2]&&s>=n[1]&&s<=n[3])return jo;var h=[0,1];if(qo(n[0]-o,c,h)&&qo(o-n[2],-c,h)&&qo(n[1]-s,l,h)&&qo(s-n[3],-l,h)){var f=h[0],g=h[1];return g<1&&(a[0]=o+g*c,a[1]=s+g*l),f>0&&(r[0]+=f*c,r[1]+=f*l),jo}}(D,W,[0,0,v,m]);var P=x.find((function(t){return t&&t.apiIndex===e})),I=!1,E=!1,O=!1;P&&(I=P.selected,E=P.rotateHandles.selected,O=P.active);var j={x:p[0]+w*R[0],y:p[1]+w*R[1]},q={x:p[0]-w*R[0],y:p[1]-w*R[1]},A={points:[{x:D[0],y:D[1]},{x:W[0],y:W[1]}],rotateHandles:{selected:E,points:[j,q]},color:r[e],apiIndex:e,selected:I,active:O};y.push(A)}},k=0;k<i.length;k++)C(k);S.setReferenceLines(y[0],y[1])}},t.render=function(t,n){var r=function(t,e){var n=t.querySelector("#".concat(e));return n||((n=document.createElement("g")).setAttribute("id",e),t.appendChild(n)),n}(t,e.widgetId),a=e.point,i=e.strokeColors,o=e.strokeWidth,s=e.strokeDashArray,u=e.rotateHandleRadius,c=e.apis,l=e.apiIndex,h=e.selectedStrokeWidth;if(null!==a[0]&&null!==a[1]){var f=c[l].svgWidgets.rotatableCrosshairsWidget.getReferenceLines(),g=parseInt(t.getAttribute("width"),10),p=parseInt(t.getAttribute("height"),10),v=a.slice();v[0]=a[0]*n,v[1]=p-a[1]*n;var m=d()(f,2),w=m[0],b=m[1],y=w.rotateHandles,M=y.points,S=y.selected,x=b.rotateHandles,C=x.points,k=x.selected,T=e.getSplitReferenceLine(w,v),R=d()(T,2),W=R[0],D=R[1],P=e.getSplitReferenceLine(b,v),I=d()(P,2),E=I[0],O=I[1],j=i[w.apiIndex],q=i[b.apiIndex],A=w.selected||w.active?h:o,L=b.selected||b.active?h:o,U=S?h:o,V=k?h:o,N=w.selected||S?u:0,F=b.selected||k?u:0,B=S?f[0].color:"none",H=k?f[1].color:"none";e.display?r.innerHTML='\n      <g id="container" fill-opacity="1" stroke-dasharray="none" stroke="none" stroke-opacity="1" fill="none">\n       <g>\n       <svg version="1.1" viewBox="0 0 '.concat(g," ").concat(p,'" width=').concat(g," height=").concat(p,' style="width: 100%; height: 100%">\n        <g\n\n          stroke="').concat(j,'"\n          stroke-dasharray="').concat(s,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width="').concat(A,'"\n        >\n        \x3c!-- First Line part 1!--\x3e\n          <line\n            x1="').concat(W[0].x,'"\n            y1="').concat(W[0].y,'"\n            x2="').concat(W[1].x,'"\n            y2="').concat(W[1].y,'"\n          ></line>\n          \x3c!-- First Line part 2!--\x3e\n          <line\n            x1="').concat(D[0].x,'"\n            y1="').concat(D[0].y,'"\n            x2="').concat(D[1].x,'"\n            y2="').concat(D[1].y,'"\n          ></line>\n        </g>\n        <g\n          stroke="').concat(f[0].color,'"\n          stroke-dasharray="').concat(s,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width="').concat(U,'"\n        >\n            \x3c!--First line rotateHandle 0 --\x3e\n            <circle cx="').concat(M[0].x,'" cy="').concat(M[0].y,'" r="').concat(N,'" fill="').concat(B,'" />\n            \x3c!--First line rotateHandle 1 --\x3e\n            <circle cx="').concat(M[1].x,'" cy="').concat(M[1].y,'" r="').concat(N,'" fill="').concat(B,'" />\n        </g>\n        <g\n          stroke-dasharray="').concat(s,'"\n          stroke="').concat(q,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width=').concat(L,'\n        >\n          \x3c!-- Second Line part 1 !--\x3e\n          <line\n            x1="').concat(E[0].x,'"\n            y1="').concat(E[0].y,'"\n            x2="').concat(E[1].x,'"\n            y2="').concat(E[1].y,'"\n          ></line>\n          \x3c!-- Second Line part 2 !--\x3e\n          <line\n            x1="').concat(O[0].x,'"\n            y1="').concat(O[0].y,'"\n            x2="').concat(O[1].x,'"\n            y2="').concat(O[1].y,'"\n          ></line>\n      </g>\n      <g\n        stroke-dasharray="').concat(s,'"\n        stroke="').concat(f[1].color,'"\n        stroke-linecap="round"\n        stroke-linejoin="round"\n        stroke-width=').concat(V,'\n      >\n        \x3c!--Second line rotateHandle 0 --\x3e\n        <circle cx="').concat(C[0].x,'" cy="').concat(C[0].y,'" r="').concat(F,'" fill="').concat(H,'" />\n        \x3c!--Second line rotateHandle 1 --\x3e\n        <circle cx="').concat(C[1].x,'" cy="').concat(C[1].y,'" r="').concat(F,'" fill="').concat(H,'" />\n      </g>\n      <circle cx="').concat(g-20,'" cy="',20,'" r="10" fill="').concat(i[l],'" />\n      </g>\n\n      '):r.innerHTML=""}},e.getSplitReferenceLine=function(t,n){var r=e.centerRadius,a=[];return o.subtract(a,[t.points[1].x,t.points[1].y],[t.points[0].x,t.points[0].y]),o.normalize(a,a),[[{x:n[0]+a[0]*r,y:n[1]+a[1]*r},t.points[1]],[{x:n[0]-a[0]*r,y:n[1]-a[1]*r},t.points[0]]]},t.resetCrosshairs=function(e,n){var r=e[n];if(r.svgWidgets.rotatableCrosshairsWidget){var a=r.genericRenderWindow.getRenderer(),i=a.getRenderWindow().getViews()[0].getViewportSize(a),o=nt.a.newInstance();o.setCoordinateSystemToDisplay(),o.setValue(.5*i[0],.5*i[1],0);for(var s=o.getComputedWorldValue(a),u=a.getActiveCamera().getDirectionOfProjection(),c=r.getSlabThickness()/2,d=0;d<s.length;d++)s[d]+=c*u[d];t.moveCrosshairs(s,e)}},t.moveCrosshairs=function(t,n){void 0!==t&&void 0!==n||console.error("worldPos, apis must be defined in order to update crosshairs."),n.forEach((function(n,r){n.set("cachedCrosshairWorldPosition",t),void 0===n.get("initialCachedCrosshairWorldPosition")&&n.set("initialCachedCrosshairWorldPosition",t);var a=n.genericRenderWindow.getRenderWindow(),i=a.getInteractor().getInteractorStyle(),o=i.getSliceNormal(),s=G.a.buildFromDegree().identity().rotateFromDirections(o,[1,0,0]),u=t.slice();s.apply(u);var c=u[0];i.setSlice(c),a.render();var d=n.genericRenderWindow.getRenderer(),l=nt.a.newInstance();l.setCoordinateSystemToWorld(),l.setValue.apply(l,h()(t));var f=l.getComputedDoubleDisplayValue(d),g=n.svgWidgetManager;n.svgWidgets.rotatableCrosshairsWidget.setPoint(f[0],f[1]),e.calculateReferenceLines(r,f),g.render()}))},t.updateCrosshairForApi=function(e){if(e.svgWidgets.rotatableCrosshairsWidget){var n=e.genericRenderWindow.getRenderer(),r=e.get("cachedCrosshairWorldPosition"),a=nt.a.newInstance();a.setCoordinateSystemToWorld(),a.setValue.apply(a,h()(r));var i=a.getComputedDoubleDisplayValue(n),o=nt.a.newInstance();o.setCoordinateSystemToDisplay(),o.setValue(i[0],i[1],0);for(var s=o.getComputedWorldValue(n),u=n.getActiveCamera().getDirectionOfProjection(),c=e.getSlabThickness()/2,d=0;d<s.length;d++)s[d]+=c*u[d];t.moveCrosshairs(s,[e])}}}var Uo={point:[null,null],apis:[null,null,null],referenceLines:[null,null],strokeColors:["#e83a0e","#ede90c","#07e345"],strokeWidth:1,rotateHandleRadius:5,selectedStrokeWidth:3,centerRadius:20,strokeDashArray:"",display:!0};function Vo(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(e,Uo,n),N.a.obj(t,e),N.a.get(t,e,["widgetId"]),N.a.setGet(t,e,["strokeWidth","selectedStrokeWidth","strokeDashArray","display","apiIndex","referenceLines","centerRadius"]),N.a.setGetArray(t,e,["point","referenceLines"],2),N.a.setGetArray(t,e,["apis","strokeColors"],3),Lo(t,e)}var No={newInstance:N.a.newInstance(Vo,"vtkSVGRotatableCrosshairsWidget"),extend:Vo},Fo=n(8),Bo=n.n(Fo);var Ho=new Map;var Go=1e-6;function _o(t,e){var n=Ho.get(e);if(n)return n;for(var r=function(t){var e=t[0],n=Bo.a.metaData.get("imagePixelModule",e),r=n.pixelRepresentation,a=n.bitsAllocated,i=n.bitsStored,o=n.highBit,s=n.photometricInterpretation,u=n.samplesPerPixel,c=Bo.a.metaData.get("voiLutModule",e),d=c.windowWidth,l=c.windowCenter;Array.isArray(d)&&(d=d[0]),Array.isArray(l)&&(l=l[0]);var h=Bo.a.metaData.get("generalSeriesModule",e).modality,f=new Map;return t.forEach((function(t){var e=Bo.a.metaData.get("imagePlaneModule",t);f.set(t,e)})),{metaData0:f.values().next().value,metaDataMap:f,imageIds:t,imageMetaData0:{bitsAllocated:a,bitsStored:i,samplesPerPixel:u,highBit:o,photometricInterpretation:s,pixelRepresentation:r,windowWidth:d,windowCenter:l,modality:h}}}(t),i=r.metaData0,o=r.metaDataMap,s=r.imageMetaData0,u=i.rowCosines,c=i.columnCosines,d=0;d<u.length;d++)Math.abs(u[d])<Go&&(u[d]=0),Math.abs(c[d])<Go&&(c[d]=0);var l=a.fromValues.apply(a,h()(u)),f=a.fromValues.apply(a,h()(c)),g=a.cross([],l,f),p=[l,f,g];B.a.orthogonalize3x3(p,p);var v,m=[].concat(h()(p[0]),h()(p[1]),h()(p[2])),w=function(t,e){var n=Array.from(e.values()),r=n[0],i=n.map((function(e){var n=a.sub([],r.imagePositionPatient,e.imagePositionPatient);return{distance:a.dot(n,t),dataset:e}}));i.sort((function(t,e){return e.distance-t.distance}));var o=i.map((function(t){return t.dataset})),s=i.map((function(t){return t.distance}));return{spacing:Math.abs(s[1]-s[0]),origin:i[0].dataset.imagePositionPatient,sortedDatasets:o}}(g,o),b=w.spacing,y=w.origin,M=w.sortedDatasets,S=i.columnPixelSpacing,x=i.rowPixelSpacing,C=b,k=i.columns,T=i.rows,R=o.size,W=1===s.pixelRepresentation;if(i.numberOfComponents>1)throw new Error("Multi component image not supported by this plugin.");switch(s.bitsAllocated){case 8:throw W?new Error("8 Bit signed images are not yet supported by this plugin."):new Error("8 Bit unsigned images are not yet supported by this plugin.");case 16:v=new Float32Array(k*T*R)}var D=Hi.a.newInstance({name:"Pixels",numberOfComponents:1,values:v}),P=Fi.a.newInstance();P.setDimensions(k,T,R),P.setSpacing(S,x,C),P.setDirection(m),P.setOrigin.apply(P,h()(y)),P.getPointData().setScalars(D);var I={imageIds:t,metaData0:i,imageMetaData0:s,dimensions:[k,T,R],spacing:[S,x,C],origin:y,direction:p,vtkImageData:P,metaDataMap:o,sortedDatasets:M,loaded:!1,subscriptions:{onPixelDataInserted:[],onPixelDataInsertedError:[],onAllPixelDataInserted:[]},onPixelDataInserted:function(t){I.subscriptions.onPixelDataInserted.push(t)},onPixelDataInsertedError:function(t){I.subscriptions.onPixelDataInsertedError.push(t)},onAllPixelDataInserted:function(t){I.subscriptions.onAllPixelDataInserted.push(t)},_publishPixelDataInserted:function(t){I.subscriptions.onPixelDataInserted.forEach((function(e){e(t)}))},_publishAllPixelDataInserted:function(){I.subscriptions.onAllPixelDataInserted.forEach((function(t){t()})),I.isLoading=!1,I.loaded=!0,I.vtkImageData.modified(),I.subscriptions={onPixelDataInserted:[],onPixelDataInsertedError:[],onAllPixelDataInserted:[]}},_publishPixelDataInsertedError:function(t){I.subscriptions.onPixelDataInsertedError.forEach((function(e){e(t)}))}};return Ho.set(e,I),I}function Yo(t){return parseFloat(".".concat(t))}function zo(t){if(!t.loaded&&!t.isLoading){var e,n=t.imageIds,r=t.vtkImageData,a=t.metaDataMap,i=t.sortedDatasets,o=n[0],s=Bo.a.metaData.get("generalSeriesModule",o),u=s&&s.modality;"PT"===u&&(e=function(t){var e=Bo.a.metaData.get("generalSeriesModule",t),n=Bo.a.metaData.get("patientStudyModule",t);if(!n)throw new Error("patientStudyModule metadata is required");var r=n.patientWeight;if(!r)throw new Error("patientWeight must be present in patientStudyModule for modality PT");var a=Bo.a.metaData.get("petIsotopeModule",t);if(!a)throw new Error("petSequenceModule metadata is required");var i=a.radiopharmaceuticalInfo,o=i.radiopharmaceuticalStartTime,s=i.radionuclideTotalDose,u=i.radionuclideHalfLife,c=e.seriesTime;if(!(o&&s&&u&&c))throw new Error("The required radiopharmaceutical information was not present.");var d=Yo(c.fractionalSeconds||0)+c.seconds+60*c.minutes+60*c.hours*60-(Yo(o.fractionalSeconds)+o.seconds+60*o.minutes+60*o.hours*60);return{patientWeight:r,correctedDose:s*Math.exp(-d*Math.log(2)/u)}}(o)),t.isLoading=!0,r.getPointData().getScalars().getData()[0]=1;var c={max:Number.NEGATIVE_INFINITY,min:Number.POSITIVE_INFINITY},d=n.length,l=0,h=d/5,f=h;!function(t,e,n){var r=this,a=Bo.a.imageLoadPoolManager,i=function(t){return Bo.a.loadAndCacheImage(t).then(e,n)};t.forEach((function(t){a.addRequest(i.bind(r,t),"prefetch",{imageId:t})}))}(n,(function(n){var o=a.get(n.imageId).imagePositionPatient,s=i.findIndex((function(t){return t.imagePositionPatient===o})),g=function(t,e,n,r,a){for(var i=t.getPointData().getScalars().getData(),o=function(t,e,n){var r=e.slope,a=e.intercept;if("PT"===t){var i=n.patientWeight,o=n.correctedDose;return function(t){return 1e3*(t*r+a)*i/o}}return function(t){return t*r+a}}(r,n,a),s=n.getPixelData(),u=s.length,c=o(s[0]),d=c,l=0;l<s.length;l++){var h=l+e*u,f=o(s[l]);f>c?c=f:f<d&&(d=f),i[h]=f}return{min:d,max:c}}(r,s,n,u,e),p=g.max,v=g.min;p>c.max&&(c.max=p),v<c.min&&(c.min=v),r.getPointData().getScalars().setRange(c,1),++l>f&&(f+=h,r.modified()),t._publishPixelDataInserted(l),l===d&&t._publishAllPixelDataInserted()}),(function(e){l++,t._publishPixelDataInsertedError(e),l===d&&t._publishAllPixelDataInserted()}))}}var Qo=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){for(var n=t.getProperty().getRGBTransferFunction(0),r=n.getSize(),a=0;a<r;a++){var i=[];n.getNodeValue(a,i),i[1]=1-i[1],i[2]=1-i[2],i[3]=1-i[3],n.setNodeValue(a,i)}e instanceof Function?e():e&&e.render&&e.render()}};n.d(e,"View2D",(function(){return no})),n.d(e,"View3D",(function(){return ro})),n.d(e,"ViewportOverlay",(function(){return Li})),n.d(e,"ViewportData",(function(){return Fr})),n.d(e,"getImageData",(function(){return _o})),n.d(e,"loadImageData",(function(){return zo})),n.d(e,"vtkInteractorStyleMPRWindowLevel",(function(){return co})),n.d(e,"vtkInteractorStyleMPRCrosshairs",(function(){return po})),n.d(e,"vtkInteractorStyleRotatableMPRCrosshairs",(function(){return So})),n.d(e,"vtkInteractorStyleMPRRotate",(function(){return Ro})),n.d(e,"vtkInteractorStyleMPRSlice",(function(){return Qr})),n.d(e,"vtkSVGWidgetManager",(function(){return aa})),n.d(e,"vtkSVGCrosshairsWidget",(function(){return Eo})),n.d(e,"vtkSVGRotatableCrosshairsWidget",(function(){return No})),n.d(e,"invertVolume",(function(){return Qo})),n.d(e,"EVENTS",(function(){return Lr}));e.default=no}])}));
//# sourceMappingURL=index.umd.min.js.map